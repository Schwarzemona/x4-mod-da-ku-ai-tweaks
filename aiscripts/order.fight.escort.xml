<?xml version='1.0' encoding='utf-8'?>
<diff>
<!-- add. purpose: params.
  <params>
-->
  <add sel="//params">
    <param name="kAAITParam_isAvoidHighRisk" required="false" type="bool" text="{1111920, 3}" default="
      if this.$kAAIT_isAvoidHighRisk_user? then 
        this.$kAAIT_isAvoidHighRisk_user
      else (
        if (not this.assignedcontrolled.isunit) and (not this.assignedcontrolled.islasertower) and
        (
          (
            this.assignedcontrolled.isplayerowned and
            (
              this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or
              this.assignedcontrolled.primarypurpose != purpose.fight or
              (
                this.assignedcontrolled.type == shiptype.carrier and
                @this.assignedcontrolled.commander.isoperational
              )
            ) and
            @global.$kAAIT_Config.$xssm_isAvoidHighRisk
          ) or
          (
            (not this.assignedcontrolled.isplayerowned) and
            (
              this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or
              this.assignedcontrolled.primarypurpose != purpose.fight or
              (
                this.assignedcontrolled.type == shiptype.carrier and
                @this.assignedcontrolled.commander.isoperational
              )
            ) and
            @global.$kAAIT_Config.$xssm_isAvoidHighRisk_allFactions
          ) or
          (
            this.assignedcontrolled.isplayerowned and
            this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
            (
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip or
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation
            )
          ) or
          (
            (not this.assignedcontrolled.isplayerowned) and
            this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
            (
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip_allFactions or
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation_allFactions
            )
          )
        ) then true else false
      )
    "/>
  </add>
<!-- add before. purpose: show movement.
  <location object="$target" condition="$target.exists" />
-->
  <add pos="before" sel="//location[@object=&quot;$target&quot;][@condition=&quot;$target.exists&quot;]">
    <location object="@$kAAIT_orderLocation_space" position="@$kAAIT_orderLocation_pos" condition="@$kAAIT_orderLocation_space and @$kAAIT_orderLocation_pos" />
  </add>
<!-- add. purpose: move to avoid or not.
  <interrupts>
    <library>
-->
  <add sel="//interrupts/library">
    <actions name="kAAIT_Actions_AvoidOrNot_Escort">
      <debug_text text="this.assignedcontrolled.idcode + ' EVENT kAAIT_Actions_AvoidOrNot_Escort'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
      <do_if value="@$target.assignedaipilot.$kAAIT_data.$defensibleTarget.isoperational or @$target.order.$primarytarget.isoperational or @$target.nextorder.$primarytarget.isoperational">
        <do_if value="@$target.assignedaipilot.$kAAIT_data.$defensibleTarget">
          <set_value name="$kAAIT_enemy" exact="$target.assignedaipilot.$kAAIT_data.$defensibleTarget" />
        </do_if>
        <do_elseif value="@$target.order.$primarytarget.isoperational">
          <set_value name="$kAAIT_enemy" exact="$target.order.$primarytarget" />
        </do_elseif>
        <do_elseif value="@$target.nextorder.$primarytarget.isoperational">
          <set_value name="$kAAIT_enemy" exact="$target.nextorder.$primarytarget" />
        </do_elseif>
        <debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_enemy: ' + $kAAIT_enemy.knownname + ' ' + $kAAIT_enemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
        <do_if value="@$kAAIT_enemy.isoperational">
          <set_value name="$kAAIT_test_target_isHighRisk" exact="$kAAIT_enemy" />
          <include_interrupt_actions ref="kAAIT_GetIsTargetHighRisk" />
          <remove_value name="$kAAIT_test_target_isHighRisk" />
          <debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_result_isTargetHighRisk: ' + $kAAIT_result_isTargetHighRisk" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
          <set_value name="$kAAIT_distToEnemy" exact="this.assignedcontrolled.bboxdistanceto.{$kAAIT_enemy}" />
          <debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_distToEnemy: ' + $kAAIT_distToEnemy" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
          <do_if value="$kAAIT_result_isTargetHighRisk">
            <do_if value="
              this.assignedcontrolled.primarypurpose != purpose.fight or
              (
                this.assignedcontrolled.type == shiptype.carrier and
                @this.assignedcontrolled.commander.isoperational
              )">
              <set_value name="this.$kAAIT_data.$target_avoid" exact="$kAAIT_enemy" />
              <include_interrupt_actions ref="kAAIT_Order_Avoid" />
            </do_if>
            <do_elseif value="$kAAIT_distToEnemy le this.assignedcontrolled.maxradarrange">
              <set_value name="$kAAIT_test_target_isInTheWay" exact="$kAAIT_enemy" />
              <set_value name="$kAAIT_test_target_isInTheWayOf" exact="$target" />
              <include_interrupt_actions ref="kAAIT_GetIsTargetInTheWay" />
              <remove_value name="$kAAIT_test_target_isInTheWay" />
              <remove_value name="$kAAIT_test_target_isInTheWayOf" />
              <do_if value="$kAAIT_result_isTargetInTheWay">
                <debug_text text="this.assignedcontrolled.idcode + ' this.assignedcontrolled.order.$kAAITParam_iskAAITOrder: ' + @this.assignedcontrolled.order.$kAAITParam_iskAAITOrder" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
                <do_if value="
                  (not @this.assignedcontrolled.order.$kAAITParam_iskAAITOrder) and
                  @$allowothertargets and
                  this.assignedcontrolled.bboxdistanceto.{$target} le this.assignedcontrolled.maxradarrange * 1.25
                ">
                  <set_value name="$kAAIT_bigEnemy" exact="$kAAIT_enemy" />
                  <include_interrupt_actions ref="kAAIT_FindSmallerTargetFarFromBigTarget" />
                </do_if>
                <do_if value="@$kAAIT_result_target_found.isoperational">
                  <set_value name="$kAAIT_target_attack" exact="$kAAIT_result_target_found" />
                  <include_interrupt_actions ref="kAAIT_Order_AttackOther" />
                </do_if>
                <do_else>
                  <set_value name="this.$kAAIT_data.$target_avoid" exact="$kAAIT_enemy" />
                  <include_interrupt_actions ref="kAAIT_Order_Avoid" />
                </do_else>
              </do_if>
            </do_elseif>
          </do_if>
        </do_if>
      </do_if>
    </actions>
  </add>
<!-- add. purpose: withdraw ai.
  <interrupts>
-->
  <add pos="prepend" sel="//interrupts">
    <handler ref="kAAIT_Handler_AvoidWithdrawOrJustFight" />
  </add>
<!-- add. purspose: do not restock if commander has an attack order or there's an enemy nearby.
  <signal_objects object="event.object" param="'resupply'" param2="[false]" param3="$debugchance" delay="10ms" comment="param2 = [urgent?, resupplystationID], param3 = $debugchance"/>
-->
  <add pos="before" sel="//signal_objects[@param=&quot;'resupply'&quot;]">
    <set_value name="$kAAIT_restockChance" exact="100" />
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <do_if value="this.assignedcontrolled.hullpercentage gt 25">
        <include_interrupt_actions ref="kAAIT_GetBigEnemies" />
        <include_interrupt_actions ref="kAAIT_GetIsNearBigEnemies" />
        <do_if value="
          @$kAAIT_bigEnemy.isoperational or
          @this.assignedcontrolled.commaner.order.id == 'Attack' or
          @this.assignedcontrolled.commaner.nextoder.id == 'Attack' or
          @this.assignedcontrolled.commaner.order.id == 'TacticalOrder' or
          @this.assignedcontrolled.commaner.nextoder.id == 'TacticalOrder'">
          <set_value name="$kAAIT_restockChance" exact="0" />
        </do_if>
      </do_if>
    </do_if>
  </add>
  <add sel="//signal_objects[@param=&quot;'resupply'&quot;]" type="@chance">$kAAIT_restockChance</add>
<!--
  Yb    dP 88 .dP"Y8 88 88""Yb 88     888888
   Yb  dP  88 `Ybo." 88 88__dP 88     88__
    YbdP   88 o.`Y8b 88 88""Yb 88  .o 88""
     YP    88 8bodP' 88 88oodP 88ood8 888888
 -->
<!-- replace. purpose: do not return if target of escort has an attack order
  <do_if value="(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km)">
    <run_script name="'move.generic'" result="$movesuccess">
-->
  <replace sel="(//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km)&quot;])[1]/@value">(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and ((@$target.order.id != 'Attack' and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km) or this.assignedcontrolled.bboxdistanceto.{$target} gt this.assignedcontrolled.maxradarrange * 2))</replace>
<!-- add. purpose: avoid?
  <do_if value="@$target.pilot">
  <do_elseif value="not $target.isownerless">
    <wait/>
-->
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;@$target.pilot&quot;]/following-sibling::do_elseif[@value=&quot;not $target.isownerless&quot;]//wait">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <wait min="1s" max="3s" />
      </do_if>
    </do_if>
  </add>
<!-- add. purpose: avoid?
  <do_while value="$target.isoperational and (($target.owner == faction.player) or $leaderpilot)">
-->
  <add pos="prepend" sel="//attention[@min=&quot;visible&quot;]//do_while[@value=&quot;$target.isoperational and (($target.owner == faction.player) or $leaderpilot)&quot;]">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <wait min="1s" max="3s" />
      </do_if>
    </do_if>
  </add>
<!-- add prepend. purpose: withdraw or not.
  <attention min="visible">
    ...
    <do_while value="$target.isoperational and (($target.owner == faction.player) or $leaderpilot)">
      <wait>
        <interrupt>
          <actions>
-->
  <add pos="prepend" sel="//attention[@min=&quot;visible&quot;]//do_while[@value=&quot;$target.isoperational and (($target.owner == faction.player) or $leaderpilot)&quot;]/wait/interrupt/actions">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <do_if value="event.name == 'event_object_attacked'">
        <set_value name="$kAAIT_test_target_isWithdraw" exact="event.param" />
        <include_interrupt_actions ref="kAAIT_Actions_WithdrawOrNot" />
        <remove_value name="$kAAIT_test_target_isWithdraw" />
        <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
          <resume label="start" />
        </do_if>
      </do_if>
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <resume label="start" />
      </do_if>
    </do_if>
  </add>
<!-- add after. purpose: finish.
  <label name="finish" />
-->
  <add pos="after" sel="//attention[@min=&quot;visible&quot;]//label[@name=&quot;finish&quot;]">
    <include_interrupt_actions ref="kAAIT_Deinit" />
  </add>
<!--
  88   88 88b 88 88  dP 88b 88  dP"Yb  Yb        dP 88b 88
  88   88 88Yb88 88odP  88Yb88 dP   Yb  Yb  db  dP  88Yb88
  Y8   8P 88 Y88 88"Yb  88 Y88 Yb   dP   YbdPYbdP   88 Y88
  `YbodP' 88  Y8 88  Yb 88  Y8  YbodP     YP  YP    88  Y8
 -->
<!-- replace. purpose: do not return if target has an atack order
  <do_if value="(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km)">
    <run_script name="'move.generic'" result="$movesuccess">
-->
  <replace sel="(//attention[@min=&quot;unknown&quot;]//do_if[@value=&quot;(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km)&quot;])[1]/@value">(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and ((@$target.order.id != 'Attack' and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km) or this.assignedcontrolled.bboxdistanceto.{$target} gt this.assignedcontrolled.maxradarrange * 2))</replace>
<!-- add before. purpose: avoid
  <do_if value="@$target.isoperational">
    <do_if value="@$target.pilot">
    <do_else>
      <wait/>
-->
  <add pos="prepend" sel="//attention[@min=&quot;unknown&quot;]//do_if[@value=&quot;@$target.pilot&quot;]/following-sibling::do_else">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <wait min="1s" max="3s" />
      </do_if>
    </do_if>
  </add>
<!-- add before. purpose: avoid
  <do_if value="@$target.isoperational">
    <do_if value="($iscarrierbased and @this.assignedcontrolled.dock.container == $target) or ($in_formation? and not $objectinhighway?)">
      <wait exact="$waittime">
-->
  <add pos="before" sel="//attention[@min=&quot;unknown&quot;]//wait[@exact=&quot;$waittime&quot;]">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <wait min="1s" max="3s" />
      </do_if>
    </do_if>
  </add>
<!-- add prepend. purpose: withdraw or not.
  <attention min="unknown">
    ...
    <do_if value="@$target.isoperational">
      ...
      <wait exact="$waittime">
        <interrupt>
          <actions>
-->
  <add pos="prepend" sel="//attention[@min=&quot;unknown&quot;]//do_if[@value=&quot;@$target.isoperational&quot;]//wait[@exact=&quot;$waittime&quot;]/interrupt/actions">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <do_if value="event.name == 'event_object_attacked'">
        <set_value name="$kAAIT_test_target_isWithdraw" exact="event.param" />
        <include_interrupt_actions ref="kAAIT_Actions_WithdrawOrNot" />
        <remove_value name="$kAAIT_test_target_isWithdraw" />
        <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
          <resume label="start" />
        </do_if>
      </do_if>
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <resume label="start" />
      </do_if>
    </do_if>
  </add>
<!-- add before. purpose: avoid
  <do_if value="@$target.isoperational">
    <do_if value="($iscarrierbased and @this.assignedcontrolled.dock.container == $target) or ($in_formation? and not $objectinhighway?)">
      <do_else>
        <do_if value="$objectinhighway?">
        <do_else>
          <move_to object="this.ship" destination="$target.zone" uselocalhighways="false" travel="true" sinceversion="2">
-->
  <add pos="before" sel="//attention[@min=&quot;unknown&quot;]//move_to[@object=&quot;this.ship&quot;][@destination=&quot;$target.zone&quot;][@uselocalhighways=&quot;false&quot;][@travel=&quot;true&quot;]">
    <do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
      <include_interrupt_actions ref="kAAIT_Actions_AvoidOrNot_Escort" />
      <do_if value="@this.$kAAIT_data.$target_avoid.isoperational">
        <wait min="1s" max="3s" />
      </do_if>
    </do_if>
  </add>
<!-- add after. purpose: finish.
  <label name="finish" />
-->
  <add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;finish&quot;]">
    <include_interrupt_actions ref="kAAIT_Deinit" />
  </add>
<!-- add. purpose: clean-up.
  <on_abort>
-->
  <add sel="//on_abort">
    <include_interrupt_actions ref="kAAIT_Deinit" />
  </add>
<!-- add. purpose: debug.
  <init>
-->
  <add pos="prepend" sel="//init">
    <debug_text text="this.assignedcontrolled.idcode + ' EVENT init'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
  </add>
  <add pos="after" sel="//attention[@min=&quot;visible&quot;]//label[@name=&quot;start&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' LABEL start'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="(//attention[@min=&quot;visible&quot;]//set_value[@name=&quot;$enemy&quot;][@exact=&quot;null&quot;])[1]">
    <debug_text text="this.assignedcontrolled.idcode + ' enemy null'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;$target.trueowner != this.trueowner&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' $target.trueowner != this.trueowner'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;@this.assignedcontrolled.allsubordinates.indexof.{$target} or ($target.isformationwingman and $target.formationleader == this.assignedcontrolled)&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' subordinates and target'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="(//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;(this.sector != $target.sector) or (((not this.assignedcontrolled.iscapitalship and not $target.zone.isclass.highway) or this.zone != $target.zone) and this.assignedcontrolled.bboxdistanceto.{$target} gt 10km)&quot;])[1]">
    <debug_text text="this.assignedcontrolled.idcode + ' far away'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//run_script[@name=&quot;'move.generic'&quot;][@result=&quot;$movesuccess&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' run_script move.generic'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//wait[@max=&quot;500ms&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' wait 500ms'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="(//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;$target.isoperational&quot;])[3]">
    <debug_text text="this.assignedcontrolled.idcode + ' before $target.isoperational'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="prepend" sel="(//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;$target.isoperational&quot;])[3]">
    <debug_text text="this.assignedcontrolled.idcode + ' prepend $target.isoperational'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="after" sel="(//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;$target.isoperational&quot;])[3]">
    <debug_text text="this.assignedcontrolled.idcode + ' after $target.isoperational'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;player.age lt @$time_rejoinformation&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' before player.age (' + player.age + ') lt @$time_rejoinformation (' + @$time_rejoinformation + '): ' + (player.age - @$time_rejoinformation)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="after" sel="//attention[@min=&quot;visible&quot;]//do_if[@value=&quot;player.age lt @$time_rejoinformation&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' after player.age (' + player.age + ') lt @$time_rejoinformation (' + @$time_rejoinformation + '): ' + (player.age - @$time_rejoinformation)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;visible&quot;]//do_while[@value=&quot;$target.isoperational and (($target.owner == faction.player) or $leaderpilot)&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' before do_while $target.isoperational'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>" />
  </add>
  <add pos="prepend" sel="//attention[@min=&quot;visible&quot;]//do_while[@value=&quot;$target.isoperational and (($target.owner == faction.player) or $leaderpilot)&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' prepend do_while $target.isoperational'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>" />
  </add>
  <add pos="after" sel="//attention[@min=&quot;visible&quot;]//do_while[@value=&quot;$target.isoperational and (($target.owner == faction.player) or $leaderpilot)&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' after do_while $target.isoperational'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>" />
  </add>
  <add pos="after" sel="//attention[@min=&quot;visible&quot;]//label[@name=&quot;finish&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' LABEL finish'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;start&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' LABEL start'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;unknown&quot;]//run_script[@name=&quot;'move.generic'&quot;][@result=&quot;$movesuccess&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' run_script move.generic'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;unknown&quot;]//wait[@exact=&quot;500ms&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' wait 500ms'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//attention[@min=&quot;unknown&quot;]//wait[@exact=&quot;$waittime&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' wait waittime'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;finish&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' LABEL finish'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <!-- DeadAir Diffs -->
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='@$target.pilot.$attacktarget.canbeattacked']/shoot_at[@tolerance='12deg']/@tolerance">4.0deg</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='@$target.pilot.$attacktarget.canbeattacked']/shoot_at[@tolerance='5deg']/@tolerance">4.0deg</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_while[@value='$target.isoperational and (($target.owner == faction.player) or $leaderpilot)']/wait/interrupt/actions/do_if/do_if[@value='@$params.{1}.canbeattacked']/shoot_at[@tolerance='12deg']/@tolerance">if $params.{1}.isclass.[class.ship_l, class.ship_xl, class.station] then 8.0deg else 4.0deg</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_while[@value='$target.isoperational and (($target.owner == faction.player) or $leaderpilot)']/wait/interrupt/actions/do_if/do_if[@value='@$params.{1}.canbeattacked']/shoot_at[@tolerance='5deg']/@tolerance">if $params.{1}.isclass.[class.ship_l, class.ship_xl, class.station] then 8.0deg else 4.0deg</replace>
</diff>
