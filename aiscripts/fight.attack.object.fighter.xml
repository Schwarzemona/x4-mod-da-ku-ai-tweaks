<?xml version="1.0" encoding="utf-8" ?>
<diff>
<!-- add. purpose: data store
	<params>
-->
	<add sel="//params">
		<param name="kAAITParam_isAvoidHighRisk" required="false" type="bool" text="{1111920, 3}" default="false" />
		<param name="kAAITParam_isStepForwardWithdraw" required="false" type="internal" text="{1111920, 109}" default="false" />
	</add>
<!-- add prepend. purpose: init var.
	<init>
-->
	<add pos="prepend" sel="//init">
		<do_if value="@$kAAITParam_isAvoidHighRisk">
			<include_interrupt_actions ref="kAAIT_Init" />
		</do_if>
	</add>
<!--
	             ,,            ,,  ,,        ,,
	             db            db *MM      `7MM
	                               MM        MM
	`7M'   `MF'`7MM  ,pP"Ybd `7MM  MM,dMMb.  MM  .gP"Ya
	  VA   ,V    MM  8I   `"   MM  MM    `Mb MM ,M'   Yb
	   VA ,V     MM  `YMMMa.   MM  MM     M8 MM 8M""""""
	    VVV      MM  L.   I8   MM  MM.   ,M9 MM YM.    ,
	     W     .JMML.M9mmmP' .JMML.P^YbmdP'.JMML.`Mbmmd'
 -->
<!-- add after. purpose: reset order locaitons
	<label name="fight" />
-->
	<add pos="after" sel="//attention[@min=&quot;visible&quot;]//label[@name=&quot;fight&quot;]">
		<do_if value="@$kAAITParam_isAvoidHighRisk and @this.$kAAIT_data.$isTargetHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
			<remove_value name="this.$kAAIT_data.$orderLocation_space" />
			<remove_value name="this.$kAAIT_data.$orderLocation_pos" />
		</do_if>
	</add>
<!--
	add before. purpose: break off attack if near a big target
	<do_while value="$target.isoperational">
		<do_if value="$target.isoperational">
-->
	<add pos="before" sel="//do_while[@value=&quot;$target.isoperational&quot;]//do_if[@value=&quot;$target.isoperational&quot;][1]">
		<do_if value="@$kAAITParam_isAvoidHighRisk and @this.$kAAIT_data.$isTargetHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
			<include_interrupt_actions ref="kAAIT_AvoidOrNot" />
		</do_if>
	</add>
<!--
	                        `7MM
	                          MM
	`7MM  `7MM  `7MMpMMMb.    MM  ,MP'`7MMpMMMb.  ,pW"Wq.`7M'    ,A    `MF'`7MMpMMMb.
	  MM    MM    MM    MM    MM ;Y     MM    MM 6W'   `Wb VA   ,VAA   ,V    MM    MM
	  MM    MM    MM    MM    MM;Mm     MM    MM 8M     M8  VA ,V  VA ,V     MM    MM
	  MM    MM    MM    MM    MM `Mb.   MM    MM YA.   ,A9   VVV    VVV      MM    MM
	  `Mbod"YML..JMML  JMML..JMML. YA..JMML  JMML.`Ybmd9'     W      W     .JMML  JMML.
 -->
<!-- add after. purpose: reset order locaitons
	<label name="fight" />
-->
	<add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;fight&quot;]">
		<do_if value="@$kAAITParam_isAvoidHighRisk and @this.$kAAIT_data.$isTargetHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
			<remove_value name="this.$kAAIT_data.$orderLocation_space" />
			<remove_value name="this.$kAAIT_data.$orderLocation_pos" />
		</do_if>
	</add>
<!--
	add before. purpose: break off attack if near a big target
	<do_while value="$target.isoperational and not $isdead" >
		<do_if value="$target.isoperational">
-->
	<add pos="before" sel="//do_while[@value=&quot;$target.isoperational and not $isdead&quot;]//do_if[@value=&quot;$target.isoperational&quot;]">
		<do_if value="@$kAAITParam_isAvoidHighRisk and @this.$kAAIT_data.$isTargetHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
			<include_interrupt_actions ref="kAAIT_AvoidOrNot" />
		</do_if>
	</add>
	<!-- DeadAir Diffs -->
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$ToleranceWeapon1'][@exact='7.0deg']/@exact">4.0deg</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$ToleranceWeapon2'][@exact='5.0deg']/@exact">4.0deg</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$MinGainDistance'][@exact='700m']/@name">$MaxGainDistance</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$MaxGainDistance'][@exact='700m']/@exact">[this.assignedcontrolled.maxcombatrange.all, this.assignedcontrolled.maxradarrange * 0.9,1400m].min</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$MaxGainDistance'][@exact='1400m']/@name">$MinGainDistance</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$MinGainDistance'][@exact='1400m']/@exact">[$MaxGainDistance * 0.5,700m].max</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$delaymissiles'][@min='player.age + 10s * (6 - (this.skill.piloting / 3))'][@max='player.age + 20s * (6 - (this.skill.piloting / 3))']/@min">player.age + 2s</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$delaymissiles'][@min='player.age + 2s'][@max='player.age + 20s * (6 - (this.skill.piloting / 3))']/@max">player.age + 5s</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/do_while[@value='$target.isoperational']/do_if[@value='$target.isoperational'][1]/do_if[@value='not this.ship.defencenpc']/do_if[@value='not $target.isclass.ship_xs and ((not this.ship.dps.lasers.all and this.ship.dps.missiles.all) or (this.ship.dps.missiles.all gt 0 and player.age gt $delaymissiles))']/set_value[@name='$delaymissiles'][@min='player.age + 10s * (6 - (this.skill.piloting / 3))'][@max='player.age + 15s * (6 - (this.skill.piloting / 3))']/@min">player.age + 2s</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/do_while[@value='$target.isoperational']/do_if[@value='$target.isoperational'][1]/do_if[@value='not this.ship.defencenpc']/do_if[@value='not $target.isclass.ship_xs and ((not this.ship.dps.lasers.all and this.ship.dps.missiles.all) or (this.ship.dps.missiles.all gt 0 and player.age gt $delaymissiles))']/set_value[@name='$delaymissiles'][@min='player.age + 2s'][@max='player.age + 15s * (6 - (this.skill.piloting / 3))']/@max">player.age + 5s</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/do_while[@value='$target.isoperational']/do_if[@value='$target.isoperational'][1]/move_to/@travel">($duration_movement gt 40s) and (((this.assignedcontrolled.bboxdistanceto.{$target} + this.assignedcontrolled.size) gt this.assignedcontrolled.maxcombatrange.all) or ((this.assignedcontrolled.bboxdistanceto.{$target} + this.assignedcontrolled.size) gt (this.assignedcontrolled.currentradarrange)))</replace>
	<replace sel="/aiscript/attention[@min='visible']/actions/do_while[@value='$target.isoperational']/do_if[@value='$target.isoperational and this.assignedcontrolled.bboxdistanceto.{$target} lt $MaxGainDistance']/do_if[@value='$allowboost and (this.assignedcontrolled.combinedskill ge 30 or this.race == race.terran) and (this.assignedcontrolled.shieldpercentage gt 50)']/@value">$allowboost and (this.assignedcontrolled.shieldpercentage gt 50)</replace>
	<replace sel="/aiscript/attention[@min='unknown']/actions/set_value[@name='$ToleranceWeapon1'][@exact='7.0deg']/@exact">4.0deg</replace>
	<replace sel="/aiscript/attention[@min='unknown']/actions/set_value[@name='$ToleranceWeapon2'][@exact='5.0deg']/@exact">4.0deg</replace>
	<replace sel="/aiscript/attention[@min='unknown']/actions/set_value[@name='$MaxGainDistance'][@exact='this.ship.maxcombatrange.all']/@exact">[this.assignedcontrolled.maxcombatrange.all, this.assignedcontrolled.maxradarrange * 0.9].min</replace>
</diff>
