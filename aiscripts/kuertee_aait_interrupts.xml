<?xml version="1.0" encoding="utf-8"?> 
<aiscript name="kuertee_aait_interrupts" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="aiscripts.xsd">
	<interrupts>
		<library>
			<actions name="kAAIT_Init">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Init'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<do_if value="@this.$beacon_from or @this.$kAAIT_target or @this.$kAAIT_orders">
					<include_interrupt_actions ref="kAAIT_CleanUpOldVersionData" />
				</do_if>
				<do_if value="not this.$kAAIT_data?">
					<debug_text text="this.assignedcontrolled.idcode + ' NEW ATTACK ORDER'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<set_value name="this.$kAAIT_data" exact="table[]" />
				</do_if>
				<do_else>
					<debug_text text="this.assignedcontrolled.idcode + ' CONTINUED ATTACK ORDER'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				</do_else>
				<include_interrupt_actions ref="kAAIT_GetCombatRange" />
				<include_interrupt_actions ref="kAAIT_GetSkillVars" />
				<do_if value="this.assignedcontrolled.order.id == 'Attack'">
					<set_value name="$kAAIT_test_target_isHighRisk" exact="@$primarytarget" />
					<do_if value="not @$kAAIT_test_target_isHighRisk.exists">
						<set_value name="$kAAIT_test_target_isHighRisk" exact="@$target" />
					</do_if>
					<include_interrupt_actions ref="kAAIT_GetIsTargetHighRisk" />
					<set_value name="this.$kAAIT_data.$defensibleTarget" exact="$kAAIT_test_target_isHighRisk" />
					<set_value name="this.$kAAIT_data.$defensibleTargetEntity" exact="@$kAAIT_target_highRiskEntity" />
					<set_value name="this.$kAAIT_data.$isTargetPotentialHighRisk" exact="@$kAAIT_isTargetPotentialHighRisk" />
					<set_value name="this.$kAAIT_data.$isTargetHighRisk" exact="@$kAAIT_result_isTargetHighRisk" />
					<remove_value name="$kAAIT_test_target_isHighRisk" />
				</do_if>
				<do_if value="$kAAITParam_isAvoidHighRisk?">
					<do_if value="not this.$kAAIT_data.$isAvoidHighRisk_saved?" comment="not saved, so save it">
						<do_if value="this.$kAAIT_isAvoidHighRisk_user?" comment="there's a user setting, use it">
							<set_value name="$kAAITParam_isAvoidHighRisk" exact="this.$kAAIT_isAvoidHighRisk_user" />
							<debug_text text="this.assignedcontrolled.idcode + ' using this.$kAAIT_isAvoidHighRisk_user: ' + this.$kAAIT_isAvoidHighRisk_user" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						</do_if>
						<set_value name="this.$kAAIT_data.$isAvoidHighRisk_saved" exact="$kAAITParam_isAvoidHighRisk" />
					</do_if>
					<do_elseif value="this.$kAAIT_data.$isAvoidHighRisk_saved != @$kAAITParam_isAvoidHighRisk" comment="changed!">
						<do_if value="this.$kAAIT_isAvoidHighRisk_user?">
							<debug_text text="this.assignedcontrolled.idcode + ' removing this.$kAAIT_isAvoidHighRisk_user: ' + this.$kAAIT_isAvoidHighRisk_user" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
							<remove_value name="this.$kAAIT_isAvoidHighRisk_user" comment="remove the user setting!" />
						</do_if>
					</do_elseif>
					<debug_text text="this.assignedcontrolled.idcode + ' $kAAITParam_isAvoidHighRisk: ' + @$kAAITParam_isAvoidHighRisk" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				</do_if>
				<do_if value="
					@this.$kAAIT_data.$isIgnoreKAAIT and
					(
						this.$kAAIT_data.$defensibleTarget.isclass.station or
						this.assignedcontrolled.shieldpercentage gt 25
					)">
					<remove_value name="this.$kAAIT_data.$isIgnoreKAAIT" />
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' this.$kAAIT_data: ' + this.$kAAIT_data" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<actions name="kAAIT_Deinit">
				<set_value name="$isDeInit" exact="true" />
				<do_if value="
					@this.assignedcontrolled.order.$kAAITParam_iskAAITOrder and
					(
						@this.assignedcontrolled.nextorder.id == 'MoveGeneric' or
						@this.assignedcontrolled.nextorder.id == 'MoveWait'
					)">
					<set_value name="$isDeInit" exact="false" />
				</do_if>
				<do_if value="$isDeInit">
					<do_if value="@this.assignedcontrolled.orders.count">
						<do_for_each name="$kAAIT_order" in="this.assignedcontrolled.orders">
							<do_if value="
								$kAAIT_order.id == 'Attack' or
								$kAAIT_order.id == 'Escort' or
								$kAAIT_order.id == 'ProtectShip'">
								<set_value name="$isDeInit" exact="false" />
								<break />
							</do_if>
						</do_for_each>
					</do_if>
				</do_if>
				<debug_text text="@this.assignedcontrolled.idcode + ' kAAIT_Deinit $isDeInit: ' + $isDeInit + ' order.id: ' + @this.assignedcontrolled.order.id + ' order.$kAAITParam_iskAAITOrder: ' + @this.assignedcontrolled.order.$kAAITParam_iskAAITOrder" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<do_if value="$isDeInit">
					<include_interrupt_actions ref="kAAIT_RemoveAttackerFromTarget" />
					<remove_value name="this.$kAAIT_data" />
					<debug_text text="@this.assignedcontrolled.idcode + ' this.$kAAIT_data: ' + @this.$kAAIT_data" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="@this.$kAAIT_tacticalOrdersToCancel">
						<do_for_each name="$kAAIT_order" in="this.$kAAIT_tacticalOrdersToCancel">
							<do_if value="@$kAAIT_order.exists and $kAAIT_order.id != 'Attack'">
								<debug_text text="this.assignedcontrolled.idcode + ' cancelled ' + $kAAIT_order.id + ' on ' + @$kAAIT_order.object.knownname + ' ' + @$kAAIT_order.object.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
								<unassign_order_syncpoint_from_order order="$kAAIT_order" />
								<cancel_order order="$kAAIT_order" />
							</do_if>
						</do_for_each>
						<remove_value name="this.$kAAIT_tacticalOrdersToCancel" />
					</do_if>
				</do_if>
			</actions>

			<actions name="kAAIT_CleanUpOldVersionData">
				<!-- start: clean-up obsolete data from previous version -->
				<!-- current version: most of these vars in this.$kAAIT_data -->
				<do_if value="@this.$beacon_from.exists"><destroy_object object="this.$beacon_from" /></do_if>
				<do_if value="@this.$beacon_to.exists"><destroy_object object="this.$beacon_to" /></do_if>
				<do_if value="@this.$beacon_avoid1.exists"><destroy_object object="this.$beacon_avoid1" /></do_if>
				<do_if value="@this.$beacon_avoid2.exists"><destroy_object object="this.$beacon_avoid2" /></do_if>
				<remove_value name="this.$beacon_from" />
				<remove_value name="this.$beacon_to" />
				<remove_value name="this.$beacon_avoid1" />
				<remove_value name="this.$beacon_avoid2" />
				<remove_value name="this.$kAAIT_data.$defensibleTarget_stopKamikaze" />
				<remove_value name="this.$kAAIT_target" />
				<remove_value name="this.$kAAIT_orders" />
				<remove_value name="this.$kAAIT_aroundDir" />
				<remove_value name="this.$kAAIT_lastAttack_enemy" />
				<remove_value name="this.$kAAIT_lastAttack_time" />
				<remove_value name="this.$kAAIT_lastAttack_timeLastSafe" />
				<remove_value name="this.$kAAIT_inchForwardCount" />
				<remove_value name="this.$kAAIT_movedOutOfRangeCount" />
				<remove_value name="this.$kAAIT_orderLocation_space" />
				<remove_value name="this.$kAAIT_orderLocation_pos" />
				<!-- end: clean-up obsolete data from previous version -->
			</actions>

			<actions name="kAAIT_AddAttackerToTarget">
				<do_if value="@this.$kAAIT_data.$defensibleTargetEntity.isoperational">
					<do_if value="not this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers?">
						<create_group groupname="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers" />
					</do_if>
					<do_if value="not this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl?">
						<create_group groupname="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" />
					</do_if>
					<do_if value="player.age - @this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_timeAdded gt 60min">
						<clear_group group="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers" />
						<clear_group group="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" />
					</do_if>
					<do_if value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]">
						<add_to_group groupname="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" object="this.assignedcontrolled" />
					</do_if>
					<do_else>
						<add_to_group groupname="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers" object="this.assignedcontrolled" />
					</do_else>
					<set_value name="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_timeAdded" exact="player.age" />
					<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_attackers (add to ' + @this.$kAAIT_data.$defensibleTarget + ' ' + @this.$kAAIT_data.$defensibleTarget.knownname + '): ' + @this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers.count" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				</do_if>
			</actions>

			<actions name="kAAIT_RemoveAttackerFromTarget">
				<do_if value="@this.$kAAIT_data.$defensibleTargetEntity.isoperational">
					<do_if value="this.assignedcontrolled">
						<do_if value="not this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers?">
							<create_group groupname="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers" />
						</do_if>
						<do_if value="not this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl?">
							<create_group groupname="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" />
						</do_if>
						<remove_from_group group="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers" object="this.assignedcontrolled" />
						<remove_from_group group="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" object="this.assignedcontrolled" />
					</do_if>
					<do_if value="not @this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers.count">
						<remove_value name="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers" />
					</do_if>
					<do_if value="not @this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl.count">
						<remove_value name="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" />
					</do_if>
					<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_attackers (remove from ' + @this.$kAAIT_data.$defensibleTarget + ' ' + @this.$kAAIT_data.$defensibleTarget.knownname + '): ' + @this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers.count" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				</do_if>
			</actions>

			<!--
				88  88    db    88b 88 8888b.  88     888888 88""Yb .dP"Y8
				88  88   dPYb   88Yb88  8I  Yb 88     88__   88__dP `Ybo."
				888888  dP__Yb  88 Y88  8I  dY 88  .o 88""   88"Yb  o.`Y8b
				88  88 dP""""Yb 88  Y8 8888Y"  88ood8 888888 88  Yb 8bodP'
			 -->
			<handler name="kAAIT_Handler_AvoidWithdrawOrJustFight">
				<!--
					NOTE: the chance in debug_text IS a TRUE/FALSE condition. when uncommented, CHANCE of 100 will pass as TRUE. best to comment out after debugging.
				-->
				<conditions>
					<check_any>
						<check_all>
							<check_any>
								<event_object_attacked object="this.assignedcontrolled" />
								<event_object_attacked_object object="this.assignedcontrolled" />
							</check_any>
							<check_value value="player.age gt @$kAAIT_time_eventAttacked" />
							<set_value name="$kAAIT_time_eventAttacked" exact="player.age + 1s" />
							<set_value name="$kAAIT_attacker" exact="if event.param.defensible then event.param.defensible else event.param" />
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_attacker.knownname (withdraw): ' + @$kAAIT_attacker.knownname + ' ' + $kAAIT_attacker.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							<check_value value="$kAAIT_attacker.isclass.[class.ship, class.station]" />
							<check_value value="not @$kAAIT_attacker.isunit" />
							<check_value value="not @$kAAIT_attacker.islasertower" />
							<check_value value="player.age gt @this.$kAAIT_data.$time_withdrawAllowed" />
							<set_value name="$kAAIT_eventType" exact="'withdraw'" />
						</check_all>
						<check_all>
							<event_gravidar_has_scanned object="if (@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.$isIgnoreKAAIT)) then this.assignedcontrolled else null" check="false"/>
							<check_value value="player.age gt @$kAAIT_time_eventGravidar" />
							<set_value name="$kAAIT_time_eventGravidar" exact="player.age + 1s" />
							<check_any>
								<check_value value="not @this.$kAAIT_data.$defensibleTarget.isoperational" comment="not in attack" />
								<check_value value="this.assignedcontrolled.bboxdistanceto.{this.$kAAIT_data.$defensibleTarget} gt this.assignedcontrolled.maxradarrange" comment="target is far" />
							</check_any>
							<count_gravidar_contacts result="$kAAIT_gravidarTarget" object="this.assignedcontrolled" class="[class.ship_l, class.ship_xl, class.station]" maybeattackedby="this.assignedcontrolled" checkoperational="false" masstraffic="false" docked="false" min="1" multiple="false">
								<match_context macro="[@this.sector.macro]"/>
								<match_context class="class.highway" negate="true"/>
								<match class="class.buildstorage" negate="true"/>
								<match state="componentstate.wreck" negate="true"/>
							</count_gravidar_contacts>
							<set_value name="$kAAIT_attacker" exact="if $kAAIT_gravidarTarget.defensible then $kAAIT_gravidarTarget.defensible else $kAAIT_gravidarTarget" />
							<check_all comment="do not avoid attack targets. note that xssm ships avoid their targets NOT from this event but from code in their AI.">
								<check_value value="$kAAIT_attacker != @this.$kAAIT_data.$defensibleTarget" />
								<check_value value="$kAAIT_attacker != @$primarytarget" />
								<check_value value="$kAAIT_attacker != @$target" />
							</check_all>
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_attacker.knownname (avoid): ' + @$kAAIT_attacker.knownname + ' ' + $kAAIT_attacker.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							<check_value value="player.age gt @this.$kAAIT_data.$time_avoidAllowed" />
							<set_value name="$kAAIT_eventType" exact="'avoid'" />
						</check_all>
					</check_any>
					<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight event.name: ' + event.name + ' @$kAAIT_eventType: ' + @$kAAIT_eventType" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
					<check_value value="@$kAAIT_eventType" />
					<set_value name="$kAAIT_attackerEntity" exact="if @$kAAIT_attacker.assignedaipilot then $kAAIT_attacker.assignedaipilot else $kAAIT_attacker.defencenpc" />
					<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_attackerEntity.name: ' + @$kAAIT_attackerEntity.name" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
					<check_value value="@$kAAIT_attackerEntity.exists" />
					<check_all comment="is allowed to actually avoid or withdraw. when changed, also change others with the 'is allowed to actually avoid or withdraw' comment.">
						<check_value value="not this.assignedcontrolled.isunit" />
						<check_value value="not this.assignedcontrolled.islasertower" />
						<check_any comment="prevent avoid while already avoiding">
							<check_value value="$kAAIT_eventType != 'avoid'" />
							<check_value value="not @this.$kAAIT_data.$isAvoiding" />
						</check_any>
						<check_value value="not @this.$kAAIT_data.$isWithdrawing" />
						<check_value value="not @this.$kAAIT_data.$isIgnoreKAAIT" />
						<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight is allowed to withdraw'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
						<check_any comment="can actually withdraw">
							<check_value value="$kAAIT_eventType == 'avoid'" />
							<check_value value="$kAAIT_attacker.isclass.station" />
							<check_value value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m]" />
							<check_all>
								<check_value value="@this.assignedcontrolled.order.id != 'Attack'" />
								<check_value value="@this.assignedcontrolled.nextorder.id != 'Attack'" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight not attacking, so withdraw'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							</check_all>
							<check_all>
								<check_value value="this.assignedcontrolled.engines.operational.count / (this.assignedcontrolled.engines.all.count)f gt 0.25" comment="has engines to withdraw" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight can withdraw has engines'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								<check_any comment="has other lxl attacker">
									<check_all>
										<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers_lxl.indexof.{this.assignedcontrolled}" />
										<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers_lxl.count gt 1" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight has other attackers including me'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
									<check_all>
										<check_value value="not @$kAAIT_attackerEntity.$kAAIT_attackers_lxl.indexof.{this.assignedcontrolled}" />
										<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers_lxl.count gt 0" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight has other attackers not including me'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
								</check_any>
							</check_all>
						</check_any>
					</check_all>
					<check_all>
						<check_any comment="is avoid high-risk. ensure that these parameters are set-up in the orders that use this handler.">
							<check_value value="@$kAAITParam_iskAAITOrder" />
							<check_value value="@$kAAITParam_isAvoidHighRisk" />
							<check_value value="@$kAAITParam_isStepForwardWithdraw" />
						</check_any>
						<check_any>
							<check_all comment="get is avoid or withdraw now. when changed, also change others with the 'get is avoid or withdraw now' comment.">
								<set_value name="$kAAIT_skillMult" exact="(@this.skill.piloting + @this.skill.morale) / 30.0" />
								<check_all comment="get is potential high risk">
									<check_any>
										<check_value value="this.assignedcontrolled.primarypurpose != purpose.fight" />
										<check_all>
											<check_value value="this.assignedcontrolled.type == shiptype.carrier" />
											<check_value value="@this.assignedcontrolled.commander.isoperational" />
										</check_all>
										<check_value value="$kAAIT_attacker.isclass.station" />
										<check_value value="$kAAIT_attacker.size gt this.assignedcontrolled.size * 1.5" />
									</check_any>
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
								</check_all>
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_isPotentialHighRiskEvent: ' + @$kAAIT_isPotentialHighRiskEvent + '. need $kAAIT_isActOnEventNow below.'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								<check_value value="$kAAIT_isPotentialHighRiskEvent" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight this.assignedcontrolled.shieldpercentage: ' + @this.assignedcontrolled.shieldpercentage" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								<check_any comment="get $kAAIT_isActOnEventNow.">
									<check_all>
										<check_value value="$kAAIT_attacker != @this.kAAIT_data.$defensibleTarget" />
										<check_value value="@this.assignedcontrolled.order.id != 'Attack'" />
										<check_value value="@this.assignedcontrolled.nextorder.id != 'Attack'" />
										<set_value name="$kAAIT_isActOnEventNow" exact="true" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight general movement avoid this!'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
									<check_value value="@$kAAIT_isActOnEventNow" />
									<check_all comment="no operational weapons">
										<check_value value="not @this.assignedcontrolled.weapons.all.count" />
										<set_value name="$kAAIT_isActOnEventNow" exact="true" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight no operational weapons'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
									<check_value value="@$kAAIT_isActOnEventNow" />
									<check_all comment="too few operational weapons">
										<check_value value="@this.assignedcontrolled.weapons.operational.count / (this.assignedcontrolled.weapons.all.count)f le 0.25" />
										<set_value name="$kAAIT_isActOnEventNow" exact="true" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight too few operational weapons'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
									<check_value value="@$kAAIT_isActOnEventNow" />
									<check_all comment="v station">
										<check_value value="$kAAIT_attacker.isclass.station" />
										<set_value name="$kAAIT_shield_withdrawAt" exact="75 + $kAAIT_skillMult * 15" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_shield_withdrawAt: ' + @$kAAIT_shield_withdrawAt" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
										<check_value value="this.assignedcontrolled.shieldpercentage le $kAAIT_shield_withdrawAt" />
										<set_value name="$kAAIT_isActOnEventNow" exact="true" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight v station shieldpercentage: ' + (this.assignedcontrolled.shieldpercentage) + ' le? ' + (75 + $kAAIT_skillMult * 15)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
									<check_value value="@$kAAIT_isActOnEventNow" />
									<check_all comment="v ship">
										<check_value value="$kAAIT_attacker.isclass.ship" />
										<set_value name="$kAAIT_shield_withdrawAt" exact="75 + $kAAIT_skillMult * 15" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_shield_withdrawAt: ' + @$kAAIT_shield_withdrawAt" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
										<check_value value="this.assignedcontrolled.shieldpercentage le $kAAIT_shield_withdrawAt" />
										<set_value name="$kAAIT_isActOnEventNow" exact="true" />
										<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight v ship shieldpercentage: ' + (this.assignedcontrolled.shieldpercentage) + ' le? ' + (75 + $kAAIT_skillMult * 15)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									</check_all>
									<check_value value="@$kAAIT_isActOnEventNow" />
								</check_any>
							</check_all>
						</check_any>
					</check_all>
					<check_value value="$kAAIT_isActOnEventNow" />
					<!-- <debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight $kAAIT_isActOnEventNow: ' + @$kAAIT_isActOnEventNow" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
				</conditions>
				<actions>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_AvoidWithdrawOrJustFight event.name: ' + event.name + ' $kAAIT_eventType: ' + @$kAAIT_eventType + ' order: ' + @this.assignedcontrolled.order.id" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<debug_text text="this.assignedcontrolled.idcode + ' ====================================== $kAAIT_attacker: ' + @$kAAIT_attacker.knownname + ', ' + @$kAAIT_attacker.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="@$kAAIT_eventType == 'withdraw'">
						<do_if value="$kAAIT_attacker != @this.$kAAIT_data.$defensibleTarget" comment="new target">
							<do_if value="
								@this.assignedcontrolled.commander.isclass.[class.ship_l, class.ship_xl] and
								this.assignedcontrolled.commander.sector == this.sector">
								<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_new_big_target'" param2="$kAAIT_attacker" />
							</do_if>
						</do_if>
					</do_if>
					<do_if value="@$kAAIT_isActOnEventNow">
						<do_if value="$kAAIT_eventType == 'avoid'">
							<set_value name="$kAAIT_test_target_isAvoid" exact="$kAAIT_attacker" />
							<include_interrupt_actions ref="kAAIT_AvoidOrNot" />
							<do_if value="@$kAAIT_result_avoidEnemy.isoperational">
								<do_if value="not this.$kAAIT_data?">
									<set_value name="this.$kAAIT_data" exact="table[]" />
								</do_if>
								<set_value name="this.$kAAIT_data.$target_avoid" exact="$kAAIT_result_avoidEnemy" />
								<include_interrupt_actions ref="kAAIT_Order_Avoid" />
							</do_if>
						</do_if>
						<do_elseif value="$kAAIT_eventType == 'withdraw'">
							<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_attacker: ' + @$kAAIT_attacker.knownname + ', ' + @$kAAIT_attacker.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
							<is_in_quadrant result="$kAAIT_isInFront" object="this.assignedcontrolled" target="$kAAIT_attacker" front="true" />
							<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_isInFront: ' + @$kAAIT_isInFront" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
							<debug_text text="this.assignedcontrolled.idcode + ' this.assignedcontrolled.bboxdistanceto.{$kAAIT_attacker}: ' + @this.assignedcontrolled.bboxdistanceto.{$kAAIT_attacker}" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
							<do_if value="$kAAIT_isInFront and this.assignedcontrolled.bboxdistanceto.{$kAAIT_attacker} le 5km">
								<do_if value="@this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl.count">
									<sort_group group="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl" sortbydistanceto="this.assignedcontrolled" sortdescending="false" />
									<do_if value="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl.indexof.{this.assignedcontrolled}">
										<set_value name="$ally" exact="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl.{2}" />
									</do_if>
									<do_else>
										<set_value name="$ally" exact="this.$kAAIT_data.$defensibleTargetEntity.$kAAIT_attackers_lxl.{1}" />
									</do_else>
								</do_if>
								<debug_text text="this.assignedcontrolled.idcode + ' $ally: ' + @$ally.knownname + ', ' + @$ally.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
								<debug_text text="this.assignedcontrolled.idcode + ' $ally.bboxdistanceto.{$kAAIT_attacker}: ' + @$ally.bboxdistanceto.{$kAAIT_attacker}" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
								<do_if value="
									(	(not @$ally.isoperational) or
										(	$ally != this.assignedcontrolled and
											$ally.bboxdistanceto.{$kAAIT_attacker} le 20km
										)
									)">
									<do_if value="
										@this.assignedcontrolled.order.id == 'Attack' and
										(not @$DefensibleScript)
									" comment="assumes this is already in an attack run_script set in order.fight.attack.object">
										<abort_called_scripts resume="kAAITLabel_withdraw" />
									</do_if>
									<do_else comment="assumes in any other order with this handler">
										<do_if value="not this.$kAAIT_data?">
											<set_value name="this.$kAAIT_data" exact="table[]" />
										</do_if>
										<set_value name="this.$kAAIT_data.$target_avoid" exact="$kAAIT_attacker" />
										<include_interrupt_actions ref="kAAIT_Order_Withdraw" />
									</do_else>
								</do_if>
							</do_if>
						</do_elseif>
					</do_if>
				    <remove_value name="$kAAIT_eventType" />
				    <remove_value name="$kAAIT_attacker" />
				    <remove_value name="$kAAIT_skillMult" />
				    <remove_value name="$kAAIT_isPotentialHighRiskEvent" />
				    <remove_value name="$kAAIT_shield_withdrawAt" />
				    <remove_value name="$kAAIT_isActOnEventNow" />
				    <remove_value name="$kAAIT_pathComponent_final" />
				</actions>
			</handler>

			<actions name="kAAIT_AvoidOrNot">
				<set_value name="$kAAIT_result_isAvoid" exact="false" />
				<do_if value="
					(not @$kAAIT_data.$isAvoiding)
					and player.age gt @this.$kAAIT_data.$time_avoidAllowed">
					<do_if value="@$kAAIT_test_target_isAvoid.isoperational">
						<set_value name="$kAAIT_attackTarget" exact="@this.$kAAIT_data.$defensibleTarget" />
						<do_if value="not $kAAIT_attackTarget.isoperational">
							<set_value name="$kAAIT_attackTarget" exact="@$primarytarget" />
						</do_if>
						<do_if value="(not $kAAIT_attackTarget.isoperational) and @$target.hasrelation.enemy.{this.assignedcontrolled}">
							<set_value name="$kAAIT_attackTarget" exact="$target" />
						</do_if>
						<do_if value="@$kAAIT_attackTarget.isoperational">
							<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_AvoidOrNot $kAAIT_attackTarget: ' + @$kAAIT_attackTarget.knownname + ' ' + @$kAAIT_attackTarget.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
							<set_value name="$kAAIT_isAttackTarget" exact="
								(	$kAAIT_test_target_isAvoid == $kAAIT_attackTarget or
									$kAAIT_test_target_isAvoid.defensible == $kAAIT_attackTarget
								)" />
							<set_value name="$kAAIT_isTakeRisk" exact="
								(	(not $kAAIT_test_target_isAvoid.isclass.station) and
									(not $kAAIT_test_target_isAvoid.isclass.ship)
								) or
								(	$kAAIT_test_target_isAvoid.isclass.station and
									this.assignedcontrolled.shieldpercentage ge @this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vStation and
									(	this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] or
										(	this.assignedcontrolled.dps.missiles.all and
											this.assignedcontrolled.ammostorage.missiles.count
										)
									)
								) or
								(	$kAAIT_test_target_isAvoid.isclass.ship and
									this.assignedcontrolled.shieldpercentage ge @this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vShip
								)" comment="v station: lxl or missiles + shields ok, v ship: shields ok" />
							<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_AvoidOrNot $kAAIT_isTakeRisk: ' + $kAAIT_isTakeRisk" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
							<do_if value="
								this.assignedcontrolled.bboxdistanceto.{$kAAIT_test_target_isAvoid} le this.assignedcontrolled.maxradarrange and
								(	this.assignedcontrolled.primarypurpose != purpose.fight or
									(	this.assignedcontrolled.type == shiptype.carrier and
										@this.assignedcontrolled.commander.isoperational
									) or
									(not $kAAIT_isTakeRisk)
								)">
								<set_value name="$kAAIT_result_avoidEnemy" exact="$kAAIT_test_target_isAvoid" />
								<set_value name="$kAAIT_result_isAvoid" exact="true" />
							</do_if>
						</do_if>
					</do_if>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_AvoidOrNot kAAIT_result_avoidEnemy (1): ' + @$kAAIT_result_avoidEnemy.knownname + ' ' + @$kAAIT_result_avoidEnemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="not $kAAIT_result_isAvoid" comment="not avoiding target but look for big enemies nearby and avoid any found">
						<include_interrupt_actions ref="kAAIT_GetBigEnemies" />
						<include_interrupt_actions ref="kAAIT_GetIsNearBigEnemies" />
						<do_if value="
							@$kAAIT_result_bigEnemy.isoperational and
							$kAAIT_result_bigEnemy != @$kAAIT_attackTarget">
							<set_value name="$kAAIT_result_avoidEnemy" exact="$kAAIT_result_bigEnemy" />
							<set_value name="$kAAIT_result_isAvoid" exact="true" />
						</do_if>
					</do_if>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_AvoidOrNot kAAIT_result_avoidEnemy (2): ' + @$kAAIT_result_avoidEnemy.knownname + ' ' + @$kAAIT_result_avoidEnemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="
						$kAAIT_result_isAvoid and
						(	$kAAIT_result_avoidEnemy != @$kAAIT_attackTarget or
							(	$kAAIT_result_avoidEnemy.isclass.station and
								this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
								$kAAIT_result_avoidEnemy == @$target.defensible
							)
						)" comment="check if avoid target is in the way of destination ONLY if (1) avoid target is in the way of attack target OR (2) ship is lxl and station core may be in the way of module target">
						<set_value name="$kAAIT_test_target_isInTheWayOf" exact="null" />
						<do_if value="@$destination">
							<set_value name="$kAAIT_test_target_isInTheWayOf" exact="$destination" />
						</do_if>
						<do_elseif value="@$kAAIT_attackTarget and $kAAIT_attackTarget != $kAAIT_result_avoidEnemy">
							<set_value name="$kAAIT_test_target_isInTheWayOf" exact="$kAAIT_attackTarget" />
						</do_elseif>
						<do_elseif value="@$primarytarget and $primarytarget != $kAAIT_result_avoidEnemy">
							<set_value name="$kAAIT_test_target_isInTheWayOf" exact="$primarytarget" />
						</do_elseif>
						<do_elseif value="@$target and $target != $kAAIT_result_avoidEnemy">
							<set_value name="$kAAIT_test_target_isInTheWayOf" exact="$target" />
						</do_elseif>
						<do_if value="$kAAIT_test_target_isInTheWayOf">
							<set_value name="$kAAIT_test_target_isInTheWay" exact="$kAAIT_result_avoidEnemy" />
							<include_interrupt_actions ref="kAAIT_GetIsTargetInTheWay" />
							<remove_value name="$kAAIT_test_target_isInTheWay" />
							<remove_value name="$kAAIT_test_target_isInTheWayOf" />
							<do_if value="not $kAAIT_result_isTargetInTheWay">
								<remove_value name="$kAAIT_result_avoidEnemy" />
								<set_value name="$kAAIT_result_isAvoid" exact="false" />
							</do_if>
						</do_if>
					</do_if>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_AvoidOrNot kAAIT_result_avoidEnemy (3): ' + @$kAAIT_result_avoidEnemy.knownname + ' ' + @$kAAIT_result_avoidEnemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="
						$kAAIT_result_isAvoid and
						@this.assignedcontrolled.order.$allowothertargets" comment="if avoiding, find smaller target first">
						<set_value name="$kAAIT_bigEnemy" exact="$kAAIT_result_avoidEnemy" />
						<include_interrupt_actions ref="kAAIT_FindSmallerTargetFarFromBigTarget" />
						<do_if value="@$kAAIT_result_target_found.isoperational">
							<remove_value name="$kAAIT_result_avoidEnemy" />
							<set_value name="$kAAIT_result_isAvoid" exact="false" />
							<set_value name="$kAAIT_target_attack" exact="$kAAIT_result_target_found" />
							<include_interrupt_actions ref="kAAIT_Order_AttackOther" />
						</do_if>
						<do_else comment="avoid now">
							<!-- calling script should test for $kAAIT_result_isAvoid and avoid $kAAIT_result_avoidEnemy -->
						</do_else>
					</do_if>
					<do_else comment="avoid now">
						<!-- calling script should test for $kAAIT_result_isAvoid and avoid $kAAIT_result_avoidEnemy -->
					</do_else>
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_AvoidOrNot kAAIT_result_avoidEnemy (final): ' + @$kAAIT_result_avoidEnemy.knownname + ' ' + @$kAAIT_result_avoidEnemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<actions name="kAAIT_Actions_WithdrawOrNot" comment="get is avoid or withdraw now. when changed, also change others with the 'get is avoid or withdraw now' comment.">
				<do_if value="@$kAAITParam_isAvoidHighRisk and (not @this.$kAAIT_data.isWithdrawing) and (not @this.$kAAIT_data.$isIgnoreKAAIT)">
					<set_value name="$kAAIT_test_target_isHighRisk" exact="$kAAIT_test_target_isWithdraw" />
					<include_interrupt_actions ref="kAAIT_GetIsTargetHighRisk" />
					<remove_value name="$kAAIT_test_target_isHighRisk" />
					<do_if value="$kAAIT_result_isTargetPotentialHighRisk">
						<do_if value="
							(not this.assignedcontrolled.weapons.all.count) or
							this.assignedcontrolled.weapons.operational.count / (this.assignedcontrolled.weapons.all.count)f le 0.25 or
							(
								$kAAIT_test_target_isWithdraw.isclass.station and
								this.assignedcontrolled.shieldpercentage le 75 + (@this.skill.piloting + @this.skill.morale) / 30.0 * 15
							) or
							(
								$kAAIT_test_target_isWithdraw.isclass.ship and
								this.assignedcontrolled.shieldpercentage le 75 + (@this.skill.piloting + @this.skill.morale) / 30.0 * 15
							)
						">
							<do_if value="not this.$kAAIT_data?">
								<set_value name="this.$kAAIT_data" exact="table[]" />
							</do_if>
							<set_value name="this.$kAAIT_data.$target_avoid" exact="$kAAIT_test_target_isWithdraw" />
							<include_interrupt_actions ref="kAAIT_Order_Withdraw" />
						</do_if>
					</do_if>
				</do_if>
			</actions>

			<handler name="kAAIT_Handler_NewBigTarget">
				<conditions>
					<check_any>
						<check_all>
							<event_object_signalled object="this.assignedcontrolled" param="'kAAIT_new_big_target'" />
							<set_value name="$kAAIT_isSignalMine" exact="true" />
						</check_all>
						<event_object_signalled object="this.assignedcontrolled.commander" param="'kAAIT_new_big_target'" check="false" />
					</check_any>
					<check_all>
						<check_value value="event.param2.isclass.[class.ship_l, class.ship_xl]" />
						<check_any comment="new target needs to be bigger or old target is a station">
							<check_value value="@event.param2.size gt @this.$kAAIT_data.$defensibleTarget.size" comment="new target is bigger than current target" />
							<check_value value="@this.$kAAIT_data.$defensibleTarget.isclass.station" comment="new LXL target is more dangerous than current station target" />
						</check_any>
						<check_all>
							<check_any comment="current order is not attack or is of different target">
								<check_value value="@this.assignedcontrolled.order.id != 'Attack'" />
								<check_value value="@this.assignedcontrolled.order.$primarytarget != event.param2" />
							</check_any>
							<check_any comment="next order is not attack or is of different target">
								<check_value value="@this.assignedcontrolled.orders.{2}.id != 'Attack'" />
								<check_value value="@this.assignedcontrolled.orders.{2}.$primarytarget != event.param2" />
							</check_any>
							<check_value value="@this.assignedcontrolled.orders.{3}.id != 'Attack'" comment="too many attack orders if there's already a 3rd attack order" />
						</check_all>
					</check_all>
					<check_any>
						<check_value value="not @this.$kAAIT_data.$attackOrder" />
						<check_value value="event.param2.size gt @this.$kAAIT_data.$defensibleTarget.size" />
					</check_any>
					<check_any>
						<check_value value="not @$kAAIT_isSignalMine" />
						<check_value value="not @$allowothertargets" />
					</check_any>
				</conditions>
				<actions>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_NewBigTarget event.name: ' + event.name" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<debug_text text="this.assignedcontrolled.idcode + ' ========================== order: ' + @this.assignedcontrolled.order.id" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<debug_text text="this.assignedcontrolled.idcode + ' size: ' + @this.$kAAIT_data.$defensibleTarget.size + ' class: ' + @this.$kAAIT_data.$defensibleTarget.class" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<debug_text text="this.assignedcontrolled.idcode + ' size: ' + event.param2.size + ' class: ' + event.param2.class" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<set_value name="$kAAIT_target_attack" exact="event.param2" />
					<include_interrupt_actions ref="kAAIT_Order_AttackOther" />
					<remove_value name="$kAAIT_isSignalMine" />
				</actions>
			</handler>

			<handler name="kAAIT_Handler_TacticalSubordinateAttack">
				<conditions>
					<check_any>
						<check_all comment="attack events">
							<check_any>
								<event_object_attacked object="this.assignedcontrolled" />
								<event_object_attacked_object object="this.assignedcontrolled" />
							</check_any>
							<check_any>
								<check_all>
									<check_value value="event.param == @$kAAITParam_tacticalOrderTarget" />
									<set_value name="$kAAIT_isTacticalTargetAttacked" exact="true" />
								</check_all>
								<check_all>
									<check_value value="event.param.isclass.ship" />
									<check_value value="event.param.size gt this.assignedcontrolled.size * 1.5" />
									<set_value name="$kAAAIT_isNewBigEnemyAttacked" exact="true" />
								</check_all>
							</check_any>
						</check_all>
						<check_all comment="movement events">
							<check_any>
								<event_object_changed_zone object="this.assignedcontrolled" />
								<event_object_changed_zone object="if @$kAAITParam_tacticalOrderTarget.isoperational then $kAAITParam_tacticalOrderTarget else null" check="false" />
							</check_any>
							<check_any>
								<check_all comment="target is near">
									<check_value value="@$kAAITParam_tacticalOrderTarget.isoperational" />
									<check_value value="this.assignedcontrolled.bboxdistanceto.{$kAAITParam_tacticalOrderTarget} le this.assignedcontrolled.maxradarrange * 0.5" />
									<set_value name="$kAAIT_isTacticalTargetNear" exact="true" />
								</check_all>
								<check_all comment="no target position recorded">
									<check_value value="@$kAAITParam_tacticalOrderTarget.isoperational" />
									<check_value value="not $kAAIT_pos_tacticatTarget?" />
									<set_value name="$kAAIT_pos_tacticatTarget" exact="$kAAITParam_tacticalOrderTarget.position" />
									<set_value name="$kAAIT_isTacticalTargetMoved" exact="true" />
								</check_all>
								<check_all comment="moved away from recorded target position">
									<check_value value="@$kAAITParam_tacticalOrderTarget.isoperational" />
									<check_value value="$kAAIT_pos_tacticatTarget?" />
									<check_value value="$kAAITParam_tacticalOrderTarget.bboxdistanceto.[$kAAITParam_tacticalOrderTarget.zone, $kAAIT_pos_tacticatTarget] gt this.assignedcontrolled.maxradarrange * 0.25" />
									<set_value name="$kAAIT_pos_tacticatTarget" exact="$kAAITParam_tacticalOrderTarget.position" />
									<set_value name="$kAAIT_isTacticalTargetMoved" exact="true" />
								</check_all>
							</check_any>
						</check_all>
					</check_any>
					<check_value value="@$kAAITParam_tacticalOrderTarget.isoperational" />
				</conditions>
				<actions>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Handler_TacticalSubordinateAttack event.name: ' + @event.name + ' event.param: ' + @event.param.knownname + ', ' + @event.param.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<debug_text text="this.assignedcontrolled.idcode + ' ======================================= order: ' + @this.assignedcontrolled.order.id" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="@$kAAAIT_isNewBigEnemyAttacked">
						<do_if value="@$kAAITParam_tacticalOrderTarget.isoperational and @$kAAITParam_tacticalOrderTarget.bboxdistanceto.{event.param} le this.assignedcontrolled.maxradarrange * 0.5"
							comment="other big enemy nearby, release all from tactical order and just attack">
							<do_if value="this.assignedcontrolled.commander.isoperational">
								<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_just_attack'" param2="table[$eventName = event.name, $eventObject = this.assignedcontrolled, $eventParam = event.param]" />
							</do_if>
						</do_if>
						<do_else comment="release self from tactical order and attack new">
							<set_value name="$kAAIT_target_attack" exact="event.param" />
							<include_interrupt_actions ref="kAAIT_Order_AttackOther" />
						</do_else>
					</do_if>
					<do_elseif value="@$kAAIT_isTacticalTargetAttacked" comment="release all from tactical order and just attack">
						<do_if value="this.assignedcontrolled.commander.isoperational">
							<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_just_attack'" param2="table[$eventName = event.name, $eventObject = this.assignedcontrolled, $eventParam = event.param]" />
						</do_if>
					</do_elseif>
					<do_elseif value="@$kAAIT_isTacticalTargetNear" comment="release all from tactical order and just attack">
						<do_if value="this.assignedcontrolled.commander.isoperational">
							<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_just_attack'" param2="table[$eventName = event.name, $eventObject = this.assignedcontrolled, $eventParam = event.param]" />
						</do_if>
					</do_elseif>
					<do_elseif value="@$kAAIT_isTacticalTargetMoved" comment="target moved away">
						<do_if value="this.assignedcontrolled.commander.isoperational">
							<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_reset_rally_points'" param2="table[$eventName = event.name, $eventObject = this.assignedcontrolled, $eventParam = event.param]" />
						</do_if>
					</do_elseif>
					<remove_value name="$kAAAIT_isNewBigEnemyAttacked" />
					<remove_value name="$kAAIT_isTacticalTargetAttacked" />
					<remove_value name="$kAAIT_isTacticalTargetNear" />
					<remove_value name="$kAAIT_isTacticalTargetMoved" />
				</actions>
			</handler>

			<!--
				88  88 888888 88     88""Yb 888888 88""Yb .dP"Y8
				88  88 88__   88     88__dP 88__   88__dP `Ybo."
				888888 88""   88  .o 88"""  88""   88"Yb  o.`Y8b
				88  88 888888 88ood8 88     888888 88  Yb 8bodP'
			 -->
			<actions name="kAAIT_GetCombatRange">
				<do_if value="not this.$kAAIT_data?">
					<set_value name="this.$kAAIT_data" exact="table[]" />
				</do_if>
				<set_value name="this.$kAAIT_data.$combatRange_max" exact="[
					this.assignedcontrolled.maxcombatrange.primary,
					this.assignedcontrolled.maxcombatrange.secondary,
					this.assignedcontrolled.maxcombatrange.lasers.all,
					this.assignedcontrolled.maxcombatrange.missiles.all,
					this.assignedcontrolled.maxcombatrange.turrets,
				].max * 0.9" />
				<set_value name="this.$kAAIT_data.$combatRange_min" exact="[
					if this.assignedcontrolled.maxcombatrange.primary then this.assignedcontrolled.maxcombatrange.primary else 1000000,
					if this.assignedcontrolled.maxcombatrange.secondary then this.assignedcontrolled.maxcombatrange.secondary else 1000000,
					if this.assignedcontrolled.maxcombatrange.lasers.all then this.assignedcontrolled.maxcombatrange.lasers.all else 1000000,
					if this.assignedcontrolled.maxcombatrange.missiles.all then this.assignedcontrolled.maxcombatrange.missiles.all else 1000000,
					if this.assignedcontrolled.maxcombatrange.turrets then this.assignedcontrolled.maxcombatrange.turrets else 1000000,
				].min * 0.9" />
				<set_value name="this.$kAAIT_data.$combatRange_mid" exact="this.$kAAIT_data.$combatRange_min + (this.$kAAIT_data.$combatRange_max - this.$kAAIT_data.$combatRange_min) * 0.5" />
			</actions>

			<actions name="kAAIT_GetIsTargetHighRisk" comment="also update 'get is avoid or withdraw now' conditions in different handlers">
				<do_if value="not this.$kAAIT_data?">
					<set_value name="this.$kAAIT_data" exact="table[]" />
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetHighRisk $kAAIT_test_target_isHighRisk: ' + @$kAAIT_test_target_isHighRisk.isoperational + ' ' + @$kAAIT_test_target_isHighRisk.knownname + ' ' + @$kAAIT_test_target_isHighRisk.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<set_value name="$kAAIT_result_isTargetHighRisk" exact="false" />
				<do_if value="@$kAAIT_test_target_isHighRisk.defensible">
					<set_value name="$kAAIT_test_target_isHighRisk" exact="$kAAIT_test_target_isHighRisk.defensible" />
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetHighRisk $kAAIT_test_target_isHighRisk (defensible): ' + @$kAAIT_test_target_isHighRisk.isoperational + ' ' + @$kAAIT_test_target_isHighRisk.knownname + ' ' + @$kAAIT_test_target_isHighRisk.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<do_if value="@$kAAIT_test_target_isHighRisk.isoperational">
					<do_if value="not @$kAAIT_target_highRiskEntity.exists">
						<set_value name="$kAAIT_target_highRiskEntity" exact="@$kAAIT_test_target_isHighRisk.assignedaipilot" />
						<do_if value="not @$kAAIT_target_highRiskEntity.exists">
							<set_value name="$kAAIT_target_highRiskEntity" exact="@$kAAIT_test_target_isHighRisk.defencenpc" />
						</do_if>
					</do_if>
					<do_if value="not @this.$kAAIT_data.$isSkillsSet">
						<include_interrupt_actions ref="kAAIT_GetSkillVars" />
					</do_if>
					<do_if value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m]">
						<set_value name="$kAAIT_isTargetPotentialHighRisk" exact="
							$kAAIT_test_target_isHighRisk.isclass.station or
							(
								$kAAIT_test_target_isHighRisk.size gt this.assignedcontrolled.size * 1.5 and
								$kAAIT_test_target_isHighRisk.primarypurpose == purpose.fight and
								@$kAAIT_test_target_isHighRisk.type != shiptype.carrier
							)
						" />
						<do_if value="$kAAIT_test_target_isHighRisk.isclass.station">
							<set_value name="$kAAIT_gunCount" exact="
								@$kAAIT_test_target_isHighRisk.weapons.operational.count + 
								[@$kAAIT_test_target_isHighRisk.weapons.operational.count, @$kAAIT_test_target_isHighRisk.turrets.operational.count].max
							" />
						</do_if>
						<do_else>
							<set_value name="$kAAIT_gunCount" exact="@$kAAIT_test_target_isHighRisk.weapons.operational.count" />
						</do_else>
						<!-- <debug_text text="''" /> -->
						<!-- <debug_text text="''" /> -->
						<!-- <debug_text text="''" /> -->
						<debug_text text="this.assignedcontrolled.idcode + ' @$kAAIT_target_highRiskEntity.$kAAIT_attackers.count (' + @$kAAIT_target_highRiskEntity.$kAAIT_attackers.count + ') * this.$kAAIT_data.$skill_attackers_count_mult (' + this.$kAAIT_data.$skill_attackers_count_mult + '): ' + (@$kAAIT_target_highRiskEntity.$kAAIT_attackers.count * this.$kAAIT_data.$skill_attackers_count_mult)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_gunCount (' + $kAAIT_gunCount + ') * global.$kAAIT_Config.$xss_outnumberVShips (' + global.$kAAIT_Config.$xss_outnumberVShips + ') / 100.0: ' + ($kAAIT_gunCount * global.$kAAIT_Config.$xss_outnumberVShips / 100.0)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_gunCount (' + $kAAIT_gunCount + ') * global.$kAAIT_Config.$xss_outnumberVStations (' + global.$kAAIT_Config.$xss_outnumberVStations + ') / 100.0: ' + ($kAAIT_gunCount * global.$kAAIT_Config.$xss_outnumberVStations / 100.0)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<set_value name="$kAAIT_result_isTargetPotentialHighRisk" exact="$kAAIT_isTargetPotentialHighRisk" />
						<set_value name="$kAAIT_result_isTargetHighRisk" exact="
							$kAAIT_isTargetPotentialHighRisk and
							(
								(
									$kAAIT_test_target_isHighRisk.isclass.station or
									this.assignedcontrolled.hullpercentage le 25
								) or
								(
									@$kAAIT_test_target_isHighRisk.hullpercentage lt 1 and
									@$kAAIT_target_highRiskEntity.$kAAIT_attackers_lxl.count
								) or
								(
									(
										this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s] or
										this.assignedcontrolled.primarypurpose != purpose.fight or
										(
											this.assignedcontrolled.type == shiptype.carrier and
											@this.assignedcontrolled.commander.isoperational
										)
									) and
									@$kAAIT_test_target_isHighRisk.isclass.ship and
									@$kAAIT_target_highRiskEntity.$kAAIT_attackers.count * this.$kAAIT_data.$skill_attackers_count_mult le $kAAIT_gunCount * global.$kAAIT_Config.$xss_outnumberVShips / 100.0
								) or
								(
									(
										this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s] or
										this.assignedcontrolled.primarypurpose != purpose.fight or
										(
											this.assignedcontrolled.type == shiptype.carrier and
											@this.assignedcontrolled.commander.isoperational
										)
									) and
									@$kAAIT_test_target_isHighRisk.isclass.station and
									@$kAAIT_target_highRiskEntity.$kAAIT_attackers.count * this.$kAAIT_data.$skill_attackers_count_mult le $kAAIT_gunCount * global.$kAAIT_Config.$xss_outnumberVStations / 100.0
								) or
								(
									this.assignedcontrolled.isclass.ship_m and
									@$kAAIT_test_target_isHighRisk.isclass.ship and
									@$kAAIT_target_highRiskEntity.$kAAIT_attackers.count * this.$kAAIT_data.$skill_attackers_count_mult le $kAAIT_gunCount * global.$kAAIT_Config.$m_outnumberVShips / 100.0
								) or
								(
									this.assignedcontrolled.isclass.ship_m and
									@$kAAIT_test_target_isHighRisk.isclass.station and
									@$kAAIT_target_highRiskEntity.$kAAIT_attackers.count * this.$kAAIT_data.$skill_attackers_count_mult le $kAAIT_gunCount * global.$kAAIT_Config.$m_outnumberVStations / 100.0
								)
							)
						"/>
					</do_if>
					<do_elseif value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]">
						<set_value name="$kAAIT_isTargetPotentialHighRisk" exact="
							$kAAIT_test_target_isHighRisk.isclass.station or
							(
								$kAAIT_test_target_isHighRisk.size gt this.assignedcontrolled.size * 1.5 and
								$kAAIT_test_target_isHighRisk.primarypurpose == purpose.fight and
								@$kAAIT_test_target_isHighRisk.type != shiptype.carrier and
								$kAAIT_test_target_isHighRisk.dps.all gt this.assignedcontrolled.dps.all * 1.25
							)
						" />
						<set_value name="$kAAIT_result_isTargetPotentialHighRisk" exact="$kAAIT_isTargetPotentialHighRisk" />
						<set_value name="$kAAIT_result_isTargetHighRisk" exact="$kAAIT_isTargetPotentialHighRisk" />
					</do_elseif>
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_isTargetPotentialHighRisk: ' + @$kAAIT_isTargetPotentialHighRisk + ' $kAAIT_result_isTargetHighRisk: ' + @$kAAIT_result_isTargetHighRisk" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<actions name="kAAIT_GetBigEnemies">
				<do_if value="not @this.$kAAIT_data.$bigEnemies.count or @this.$kAAIT_data.$bigEnemies.{1}.bboxdistanceto.{this.assignedcontrolled} gt this.assignedcontrolled.maxradarrange">
					<do_if value="not this.$kAAIT_data?">
						<set_value name="this.$kAAIT_data" exact="table[]" />
					</do_if>
					<create_group groupname="this.$kAAIT_data.$bigEnemies" />
					<find_gravidar_contact groupname="this.$kAAIT_data.$bigEnemies" object="this.assignedcontrolled" class="[class.ship_l, class.ship_xl, class.station]" docked="false" functional="true" maybeattackedby="this.assignedcontrolled" multiple="true" chance="if @this.sector.macro then 100 else 0">
						<match_context macro="[@this.sector.macro]"/>
						<match class="class.buildstorage" negate="true"/>
						<match state="componentstate.wreck" negate="true"/>
						<!-- <match_distance max="this.assignedcontrolled.maxradarrange * 0.5" object="this.assignedcontrolled" /> -->
					</find_gravidar_contact>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetBigEnemies this.$kAAIT_data.$bigEnemies.count (find_gravidar_contact): ' + @this.$kAAIT_data.$bigEnemies.count" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="@$kAAITParam_enemyAvoid">
						<add_to_group groupname="this.$kAAIT_data.$bigEnemies" object="$kAAITParam_enemyAvoid" />
						<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetBigEnemies this.$kAAIT_data.$bigEnemies.count (added $kAAITParam_enemyAvoid): ' + @this.$kAAIT_data.$bigEnemies.count" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					</do_if>
					<sort_group group="this.$kAAIT_data.$bigEnemies" sortbyvalue="this.assignedcontrolled.bboxdistanceto.{loop.element}" sortdescending="false" />
				</do_if>
				<do_else>
					<sort_group group="this.$kAAIT_data.$bigEnemies" sortbyvalue="this.assignedcontrolled.bboxdistanceto.{loop.element}" sortdescending="false" />
				</do_else>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetBigEnemies this.$kAAIT_data.$bigEnemies.count (final): ' + @this.$kAAIT_data.$bigEnemies.count" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<actions name="kAAIT_GetIsNearBigEnemies">
				<set_value name="$kAAIT_result_isShipNearBigEnemy" exact="false" />
				<set_value name="$kAAIT_result_isTargetNearBigEnemy" exact="false" />
				<set_value name="$kAAIT_result_bigEnemy" exact="null" />
				<do_if value="@this.$kAAIT_data.$bigEnemies.count">
					<do_for_each name="$kAAIT_bigEnemy_inList" in="this.$kAAIT_data.$bigEnemies">
						<!-- <do_if value="$kAAIT_bigEnemy_inList != @this.$kAAIT_data.$defensibleTarget"> -->
							<do_if value="$kAAIT_bigEnemy_inList.bboxdistanceto.{this.assignedcontrolled} le this.assignedcontrolled.maxradarrange * 0.5">
								<set_value name="$kAAIT_result_isShipNearBigEnemy" exact="true" />
							</do_if>
							<do_if value="$kAAIT_bigEnemy_inList != @this.$kAAIT_data.$defensibleTarget">
								<do_if value="
									(
										@this.$kAAIT_data.$defensibleTarget.isoperational and
										$kAAIT_bigEnemy_inList.bboxdistanceto.{this.$kAAIT_data.$defensibleTarget} le this.assignedcontrolled.maxradarrange * 0.5
									) or
									(
										@$target.isoperational and
										$kAAIT_bigEnemy_inList.bboxdistanceto.{$target} le this.assignedcontrolled.maxradarrange * 0.5
									)
								">
									<set_value name="$kAAIT_result_isTargetNearBigEnemy" exact="true" />
								</do_if>
							</do_if>
							<do_if value="$kAAIT_result_isShipNearBigEnemy or $kAAIT_result_isTargetNearBigEnemy">
								<set_value name="$kAAIT_result_bigEnemy" exact="$kAAIT_bigEnemy_inList" />
								<break />
							</do_if>
						<!-- </do_if> -->
					</do_for_each>
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsNearBigEnemies $kAAIT_result_isShipNearBigEnemy: ' + $kAAIT_result_isShipNearBigEnemy + ' $kAAIT_result_isTargetNearBigEnemy: ' + $kAAIT_result_isTargetNearBigEnemy" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsNearBigEnemies $kAAIT_result_bigEnemy: ' + @$kAAIT_result_bigEnemy.knownname + ' ' + @$kAAIT_result_bigEnemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<actions name="kAAIT_FindSmallerTargetFarFromBigTarget">
				<set_value name="$kAAIT_result_target_found" exact="null" />
				<do_if value="
					this.assignedcontrolled.primarypurpose == purpose.fight and
					(
						this.assignedcontrolled.type != shiptype.carrier or
						(not @this.assignedcontrolled.commander.isoperational)
					) and
					(not @this.$kAAIT_data.$attackOrder.exists)">
					<do_if value="$kAAIT_bigEnemy.isclass.ship">
						<set_value name="$kAAIT_dist_min" exact="this.assignedcontrolled.maxradarrange * 0.25" />
					</do_if>
					<do_else>
						<set_value name="$kAAIT_dist_min" exact="this.assignedcontrolled.maxradarrange * 0.5" />
					</do_else>
					<find_gravidar_contact name="$kAAIT_smallTargets" object="this.assignedcontrolled" class="[class.ship_xs, class.ship_s, class.ship_m]" docked="false" functional="true" maybeattackedby="this.assignedcontrolled" sortbydistanceto="this.assignedcontrolled" multiple="true">
						<match_context macro="[@this.sector.macro]"/>
						<match class="class.buildstorage" negate="true"/>
						<match state="componentstate.wreck" negate="true"/>
						<match_distance min="$kAAIT_dist_min" max="this.assignedcontrolled.maxradarrange" object="$kAAIT_bigEnemy" />
					</find_gravidar_contact>
					<sort_list list="$kAAIT_smallTargets" sortbyvalue="loop.element.size" sortdescending="false" />
					<set_value name="$kAAIT_result_target_found" exact="@$kAAIT_smallTargets.{1}" />
					<do_if value="@$kAAIT_result_target_found.isoperational and $kAAIT_result_target_found.size le this.assignedcontrolled.size * 1.5">
						<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_result_target_found (pre obstruction test): ' + @$kAAIT_result_target_found" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<do_if value="$kAAIT_result_target_found.bboxdistanceto.{$kAAIT_bigEnemy} gt this.assignedcontrolled.bboxdistanceto.{$kAAIT_bigEnemy}" comment="because this is circling a big target already, any object farther away would put the big target in the way">
							<set_value name="$kAAIT_result_target_found" exact="null" />
						</do_if>
						<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_result_target_found (post-obstruction test): ' + @$kAAIT_result_target_found" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					</do_if>
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_FindSmallerTargetFarFromBigTarget $kAAIT_result_target_found: ' + @$kAAIT_result_target_found.knownname + ' ' + @$kAAIT_result_target_found.idcode + ' size: ' + @$kAAIT_result_target_found.size + ' weapons: ' + @$kAAIT_result_target_found.weapons.operational.count" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<actions name="kAAIT_GetSkillVars" comment="also update 'get is avoid or withdraw now' conditions in different handlers">
				<do_if value="not this.$kAAIT_data?">
					<set_value name="this.$kAAIT_data" exact="table[]" />
				</do_if>
				<do_if value="global.$kAAIT_Config.$isUseNPCSkills">
					<set_value name="this.$kAAIT_data.$skill_attackers_count_mult" exact="2 - (this.skill.piloting + this.skill.morale) / 30.0 * 1" comment="0 = * 2, 5 = * 1" />
					<set_value name="this.$kAAIT_data.$skill_distance_engagePosition_mult" exact="0.75 + (this.skill.piloting + this.skill.morale) / 30.0 * 0.25" comment="combat range max * (0 = * 0.75, 5 = 1)" />
					<set_value name="this.$kAAIT_data.$skill_distance_stepForward_mult" exact="2 - (this.skill.piloting + this.skill.morale) / 30.0 * 1" comment="count of step forwards * (0 = 2km, 5 = 1km)" />
					<do_if value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m]">
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vShip" exact="75 + (this.skill.piloting + this.skill.morale) / 30.0 * 15" comment="0 = 75, 5 = 90" />
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vStation" exact="75 + (this.skill.piloting + this.skill.morale) / 30.0 * 15" comment="0 = 75, 5 = 90" />
					</do_if>
					<do_elseif value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]">
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vShip" exact="75 + (this.skill.piloting + this.skill.morale) / 30.0 * 15" comment="0 = 75, 5 = 90" />
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vStation" exact="75 + (this.skill.piloting + this.skill.morale) / 30.0 * 15" comment="0 = 75, 5 = 90" />
					</do_elseif>
					<set_value name="this.$kAAIT_data.$skill_distance_withdraw" exact="this.assignedcontrolled.maxradarrange * (0.35 + (this.skill.piloting + this.skill.morale) / 30.0 * 0.15)" comment="0 = * 0.35, 5 = * 0.5" />
				</do_if>
				<do_else>
					<set_value name="this.$kAAIT_data.$skill_attackers_count_mult" exact="1" />
					<set_value name="this.$kAAIT_data.$skill_distance_engagePosition_mult" exact="1" />
					<set_value name="this.$kAAIT_data.$skill_distance_stepForward_mult" exact="1" />
					<do_if value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m]">
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vShip" exact="90" />
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vStation" exact="90" />
					</do_if>
					<do_elseif value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]">
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vShip" exact="90" />
						<set_value name="this.$kAAIT_data.$skill_shieldPercentage_withdrawAt_vStation" exact="90" />
					</do_elseif>
					<set_value name="this.$kAAIT_data.$skill_distance_withdraw" exact="this.assignedcontrolled.maxradarrange * 0.5" />
				</do_else>
				<set_value name="this.$kAAIT_data.$isSkillsSet" exact="true" />
			</actions>

			<actions name="kAAIT_GetEscortPos">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetEscortPos'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<create_position name="$kAAIT_pos_self" space="this.sector" object="this.assignedcontrolled" />
				<create_position name="$kAAIT_pos_escort" space="this.sector" object="$kAAIT_target_escort" />
				<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_target_escort: ' + $kAAIT_target_escort.knownname + ' ' + $kAAIT_target_escort.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<create_orientation name="$kAAIT_rot_fromEscort" orientation="look_at" refposition="$kAAIT_pos_self">
					<position value="$kAAIT_pos_escort" />
				</create_orientation>
				<set_value name="$kAAIT_yaw_fromEscort" exact="$kAAIT_rot_fromEscort.yaw * 180 / pi" />
				<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_yaw_fromEscort: ' + $kAAIT_yaw_fromEscort" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<set_value name="$kAAIT_pitch_fromEscort" exact="$kAAIT_rot_fromEscort.pitch * 180 / pi" />
				<set_value name="$kAAIT_escortEnemy" exact="null" />
				<do_if value="@$kAAIT_target_escort.assignedaipilot.$kAAIT_data.$defensibleTarget.isoperational">
					<set_value name="$kAAIT_escortEnemy" exact="$kAAIT_target_escort.assignedaipilot.$kAAIT_data.$defensibleTarget" />
				</do_if>
				<do_elseif value="@$kAAIT_target_escort.order.$primarytarget.isoperational">
					<set_value name="$kAAIT_escortEnemy" exact="$kAAIT_target_escort.order.$primarytarget" />
				</do_elseif>
				<do_elseif value="@$kAAIT_target_escort.nextorder.$primarytarget.isoperational">
					<set_value name="$kAAIT_escortEnemy" exact="$kAAIT_target_escort.nextorder.$primarytarget" />
				</do_elseif>
				<do_elseif value="@$kAAIT_target_escort.order.$selectedtarget.isoperational">
					<set_value name="$kAAIT_escortEnemy" exact="$kAAIT_target_escort.order.$selectedtarget" />
				</do_elseif>
				<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_escortEnemy: ' + @$kAAIT_escortEnemy.knownname + ' ' + @$kAAIT_escortEnemy.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<do_if value="$kAAIT_escortEnemy">
					<create_position name="$kAAIT_pos_escortEnemy" space="this.sector" object="$kAAIT_escortEnemy" />
					<create_orientation name="$kAAIT_rot_fromEnemyToEscort" orientation="look_at" refposition="$kAAIT_pos_escort">
						<position value="$kAAIT_pos_escortEnemy" />
					</create_orientation>
					<set_value name="$kAAIT_result_yawDeg" exact="$kAAIT_rot_fromEnemyToEscort.yaw * 180 / pi" />
					<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_result_yawDeg: ' + $kAAIT_result_yawDeg" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<set_value name="$kAAIT_result_pitchDeg" exact="$kAAIT_rot_fromEnemyToEscort.pitch * 180 / pi" />
					<set_value name="$kAAIT_index_self" exact="$kAAIT_target_escort.subordinates.indexof.{this.assignedcontrolled}" />
					<set_value name="$kAAIT_maxAngle" exact="45" />
					<do_if value="$kAAIT_target_escort.subordinates.count gt 1">
						<set_value name="$kAAIT_angleForOneShip" exact="$kAAIT_maxAngle * 2 / ($kAAIT_target_escort.subordinates.count - 1)f" />
					</do_if>
					<do_else>
						<set_value name="$kAAIT_angleForOneShip" exact="5" />
					</do_else>
					<set_value name="$kAAIT_yaw_adj" exact="($kAAIT_maxAngle * -1) + (($kAAIT_index_self - 1) * $kAAIT_angleForOneShip)" />
					<set_value name="$kAAIT_result_yawDeg" operation="add" exact="$kAAIT_yaw_adj" />
				</do_if>
				<do_else>
					<set_value name="$kAAIT_result_yawDeg" exact="$kAAIT_yaw_fromEscort" />
					<set_value name="$kAAIT_result_pitchDeg" exact="$kAAIT_pitch_fromEscort" />
				</do_else>
				<set_value name="$kAAIT_result_yawRad" exact="$kAAIT_result_yawDeg * pi / 180" />
				<set_value name="$kAAIT_result_pitchRad" exact="$kAAIT_result_pitchDeg * pi / 180" />
				<create_position name="$kAAIT_result_pos_escort"
					x="$kAAIT_pos_escort.x + 10km * sin ($kAAIT_result_yawRad) * cos ($kAAIT_result_pitchRad)"
					y="$kAAIT_pos_escort.y + 10km * sin ($kAAIT_result_pitchRad)"
					z="$kAAIT_pos_escort.z + 10km * cos ($kAAIT_result_yawRad) * cos ($kAAIT_result_pitchRad)"/>
				<!-- <do_if value="$kAAIT_pos_escortEnemy">
					<create_orientation name="$kAAIT_rot_fromEnemyToEscort" orientation="look_at" refposition="$kAAIT_result_pos_escort">
						<position value="$kAAIT_pos_escortEnemy" />
					</create_orientation>
					<set_value name="$kAAIT_yaw_final" exact="$kAAIT_rot_fromEnemyToEscort.yaw * 180 / pi" />
					<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_yaw_final: ' + $kAAIT_yaw_final" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				</do_if> -->
			</actions>

			<actions name="kAAIT_GetIsTargetInTheWay">
				<!-- <do_if value="not @$kAAIT_space_getGlobalPath or this.assignedcontrolled.bboxdistanceto.[$kAAIT_space_getGlobalPath, $kAAIT_position_getGlobalPath] gt this.assignedcontrolled.maxradarrange"> -->
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_test_target_isInTheWay: ' + @$kAAIT_test_target_isInTheWay.knownname + ' ' + @$kAAIT_test_target_isInTheWay.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_test_target_isInTheWayOf: ' + @$kAAIT_test_target_isInTheWayOf.knownname + ' ' + @$kAAIT_test_target_isInTheWayOf.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<set_value name="$kAAIT_result_isTargetInTheWay" exact="false" />
				<do_if value="(typeof $kAAIT_test_target_isInTheWayOf) == datatype.component">
					<do_if value="not @$kAAIT_space_getGlobalPath or this.sector != $kAAIT_space_getGlobalPath">
						<set_value name="$kAAIT_space_getGlobalPath" exact="this.sector" />
						<create_position name="$kAAIT_position_getGlobalPath" object="this.assignedcontrolled" />
						<set_value name="$kAAIT_dist_toTarget" exact="this.assignedcontrolled.bboxdistanceto.{$kAAIT_test_target_isInTheWay}" />
						<get_global_path component="$kAAIT_pathComponents" uselocalhighways="true" multiple="true">
							<start object="this.assignedcontrolled" />
							<end object="$kAAIT_test_target_isInTheWayOf" />
						</get_global_path>
					</do_if>
					<do_if value="$kAAIT_pathComponents.count">
						<set_value name="$kAAIT_pathComponent" exact="$kAAIT_pathComponents.{1}" />
						<do_if value="$kAAIT_pathComponent == this.assignedcontrolled">
							<set_value name="$kAAIT_pathComponent" exact="$kAAIT_pathComponents.{2}" />
						</do_if>
					</do_if>
					<do_else>
						<set_value name="$kAAIT_pathComponent" exact="$kAAIT_test_target_isInTheWayOf" />
					</do_else>
					<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_pathComponent: ' + @$kAAIT_pathComponent.knownname + ' (' + $kAAIT_pathComponent.class + ') ' + @$kAAIT_pathComponent.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
					<do_if value="$kAAIT_pathComponent == this.sector or @$kAAIT_pathComponent.sector == this.sector">
						<create_position name="$kAAIT_pos_self" space="this.sector" object="this.assignedcontrolled" />
						<create_position name="$kAAIT_pos_enemy" space="this.sector" object="$kAAIT_test_target_isInTheWay" />
						<set_value name="$kAAIT_dist_toEnemy" exact="this.assignedcontrolled.bboxdistanceto.[this.sector, $kAAIT_pos_enemy]" />
						<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_dist_toEnemy: ' + @$kAAIT_dist_toEnemy" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<create_orientation name="$kAAIT_rot_toEnemy" orientation="look_at" refposition="$kAAIT_pos_enemy">
							<position value="$kAAIT_pos_self" />
						</create_orientation>
						<set_value name="$kAAIT_yaw_toEnemy" exact="$kAAIT_rot_toEnemy.yaw * 180 / pi" />
						<do_if value="@$destination and @$position">
							<create_position name="$kAAIT_pos_dest" space="this.sector" object="$destination" value="$position" />
							<set_value name="$kAAIT_dist_toDest" exact="this.assignedcontrolled.bboxdistanceto.[$destination, $position]" />
							<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_dist_toDest (MoveGeneric $destination): ' + @$kAAIT_dist_toDest" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						</do_if>
						<do_elseif value="@$positionspace and @$position">
							<create_position name="$kAAIT_pos_dest" space="this.sector" object="$positionspace" value="$position" />
							<set_value name="$kAAIT_dist_toDest" exact="this.assignedcontrolled.bboxdistanceto.[$positionspace, $position]" />
							<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_dist_toDest (MoveGeneric $positionspace): ' + @$kAAIT_dist_toDest" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						</do_elseif>
						<do_elseif value="@$position">
							<create_position name="$kAAIT_pos_dest" space="this.sector" object="$kAAIT_pathComponent" value="$position" />
							<set_value name="$kAAIT_dist_toDest" exact="this.assignedcontrolled.bboxdistanceto.[this.sector, $kAAIT_pos_dest]" />
							<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_dist_toDest (position): ' + @$kAAIT_dist_toDest" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						</do_elseif>
						<do_else>
							<create_position name="$kAAIT_pos_dest" space="this.sector" object="$kAAIT_pathComponent" />
							<set_value name="$kAAIT_dist_toDest" exact="this.assignedcontrolled.bboxdistanceto.{$kAAIT_pathComponent}" />
							<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_dist_toDest (no position): ' + @$kAAIT_dist_toDest" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						</do_else>
						<create_orientation name="$kAAIT_rot_toDest" orientation="look_at" refposition="$kAAIT_pos_dest">
							<position value="$kAAIT_pos_self" />
						</create_orientation>
						<set_value name="$kAAIT_yaw_toDest" exact="$kAAIT_rot_toDest.yaw * 180 / pi" />
						<set_value name="$kAAIT_yaw_diff" exact="$kAAIT_yaw_toDest - $kAAIT_yaw_toEnemy" />
						<set_value name="$kAAIT_isBothInFront" exact="$kAAIT_yaw_diff gt -45 and $kAAIT_yaw_diff lt 45" />
						<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_isBothInFront: ' + @$kAAIT_isBothInFront" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<do_if value="$kAAIT_isBothInFront and $kAAIT_dist_toEnemy lt $kAAIT_dist_toDest">
							<set_value name="$kAAIT_result_isTargetInTheWay" exact="true" />
						</do_if>
					</do_if>
					<do_else>
						<set_value name="$kAAIT_result_isTargetInTheWay" exact="false" />
					</do_else>
				</do_if>
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_GetIsTargetInTheWay $kAAIT_result_isTargetInTheWay: ' + @$kAAIT_result_isTargetInTheWay" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
			</actions>

			<!--
				 dP"Yb  88""Yb 8888b.  888888 88""Yb .dP"Y8
				dP   Yb 88__dP  8I  Yb 88__   88__dP `Ybo."
				Yb   dP 88"Yb   8I  dY 88""   88"Yb  o.`Y8b
				 YbodP  88  Yb 8888Y"  888888 88  Yb 8bodP'
			 -->
			<actions name="kAAIT_CleanOrders">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_CleanOrders order: ' + @this.assignedcontrolled.order.id" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<do_for_each name="$kAAIT_order" in="this.assignedcontrolled.orders" counter="$i" reverse="true">
					<do_if value="@$kAAIT_order.$kAAITParam_iskAAITOrder and $i gt 1" comment="cancel other move.kuertee.*.xml order">
						<debug_text text="this.assignedcontrolled.idcode + ' cancel_order ' + $kAAIT_order.id" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
						<cancel_order order="$kAAIT_order" />
					</do_if>
				</do_for_each>
			</actions>

			<actions name="kAAIT_Order_AttackOther">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Order_AttackOther'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' ======================='" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' $kAAIT_target_attack: ' + @$kAAIT_target_attack.knownname + ' ' + @$kAAIT_target_attack.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<include_interrupt_actions ref="kAAIT_CleanOrders" />
				<do_if value="this.assignedcontrolled.order">
					<unassign_order_syncpoint_from_order order="this.assignedcontrolled.order" />
					<do_if value="this.assignedcontrolled.commander.isoperational">
						<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_remove_subordinate'" param2="this.assignedcontrolled" />
					</do_if>
				</do_if>
				<create_order name="$kAAIT_order_attack" object="this.assignedcontrolled" id="'Attack'" immediate="true">
					<param name="primarytarget" value="$kAAIT_target_attack" />
					<param name="pursuedistance" value="this.assignedcontrolled.maxradarrange" />
					<param name="pursuetargets" value="false" />
					<!-- <param name="kAAITParam_iskAAITOrder" value="true" /> -->
					<param name="kAAITParam_isAvoidHighRisk" value="@$kAAITParam_isAvoidHighRisk" />
					<param name="kAAITParam_isStepForwardWithdraw" value="@$kAAITParam_isStepForwardWithdraw" />
					<param name="debugchance" value="$debugchance"/>
				</create_order>
				<set_value name="this.$kAAIT_data.$attackOrder" exact="$kAAIT_order_attack" />
			</actions>

			<actions name="kAAIT_Order_Avoid">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Order_Avoid'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' ================='" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' this.$kAAIT_data.$target_avoid: ' + @this.$kAAIT_data.$target_avoid.knownname + ' ' + @this.$kAAIT_data.$target_avoid.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<include_interrupt_actions ref="kAAIT_CleanOrders" />
				<do_if value="this.assignedcontrolled.order">
					<unassign_order_syncpoint_from_order order="this.assignedcontrolled.order" />
					<do_if value="this.assignedcontrolled.commander.isoperational">
						<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_remove_subordinate'" param2="this.assignedcontrolled" />
					</do_if>
				</do_if>
				<set_value name="$kAAIT_isImmediate" exact="true" />
				<do_if value="@this.assignedcontrolled.order.id == 'TacticalOrder'">
					<set_value name="$kAAIT_isImmediate" exact="false" />
				</do_if>
				<create_order object="this.assignedcontrolled" id="'kAAIT_MoveAvoid'" immediate="$kAAIT_isImmediate">
					<param name="target" value="this.$kAAIT_data.$target_avoid" />
				</create_order>
				<do_if value="not $kAAIT_isImmediate" comment="if TacticalOrder, cancel it. then re-add it.">
					<set_value name="$kAAIT_target_attack" exact="this.assignedcontrolled.order.$selectedtarget" />
					<set_value name="$kAAIT_aggressiveness" exact="this.assignedcontrolled.order.$aggressiveness" />
					<set_value name="$kAAIT_weakfirst" exact="this.assignedcontrolled.order.$weakfirst" />
					<set_value name="$kAAIT_xdistance" exact="this.assignedcontrolled.order.$xdistance" />
					<set_value name="$kAAIT_zdistance" exact="this.assignedcontrolled.order.$zdistance" />
					<set_value name="$kAAIT_timeout" exact="this.assignedcontrolled.order.$timeout" />
					<cancel_order order="this.assignedcontrolled.order" />
					<create_order object="this.assignedcontrolled" id="'TacticalOrder'">
						<param name="selectedtarget" value="$kAAIT_target_attack" />
						<param name="aggressiveness" value="$kAAIT_aggressiveness" />
						<param name="weakfirst" value="$kAAIT_weakfirst" />
						<param name="xdistance" value="$kAAIT_xdistance" />
						<param name="zdistance" value="$kAAIT_zdistance" />
						<param name="timeout" value="$kAAIT_timeout" />
					</create_order>
				</do_if>
			</actions>

			<actions name="kAAIT_Order_Flee">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Order_Flee'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' ================'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' this.$kAAIT_data.$target_avoid: ' + @this.$kAAIT_data.$target_avoid.knownname + ' ' + @this.$kAAIT_data.$target_avoid.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<include_interrupt_actions ref="kAAIT_CleanOrders" />
				<do_if value="this.assignedcontrolled.order">
					<unassign_order_syncpoint_from_order order="this.assignedcontrolled.order" />
					<do_if value="this.assignedcontrolled.commander.isoperational">
						<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_remove_subordinate'" param2="this.assignedcontrolled" />
					</do_if>
				</do_if>
				<create_order object="this.assignedcontrolled" id="'Flee'" immediate="true">
					<param name="method" value="'boost'"/>
					<param name="attacker" value="this.$kAAIT_data.$target_avoid"/>
					<param name="donotdrop" value="true"/>
					<param name="deploydistraction" value="@this.$kAAIT_data.$defensibleTarget.isclass.ship"/>
					<param name="log" value="false"/>
					<param name="kAAITParam_iskAAITOrder" value="true"/>
					<param name="debugchance" value="$debugchance"/>
				</create_order>
			</actions>

			<actions name="kAAIT_Order_MoveToEngagePosition">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Order_MoveToEngagePosition'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' ================================'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' this.$kAAIT_data.$target_avoid: ' + @this.$kAAIT_data.$target_avoid.knownname + ' ' + @this.$kAAIT_data.$target_avoid.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<include_interrupt_actions ref="kAAIT_CleanOrders" />
				<do_if value="this.assignedcontrolled.order">
					<unassign_order_syncpoint_from_order order="this.assignedcontrolled.order" />
					<do_if value="this.assignedcontrolled.commander.isoperational">
						<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_remove_subordinate'" param2="this.assignedcontrolled" />
					</do_if>
				</do_if>
				<create_order object="this.assignedcontrolled" id="'kAAIT_MoveEngagePosition'" immediate="true">
					<param name="target" value="this.$kAAIT_data.$target_avoid"/>
				</create_order>
			</actions>

			<actions name="kAAIT_Order_Withdraw">
				<debug_text text="this.assignedcontrolled.idcode + ' kAAIT_Order_Withdraw'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' ===================='" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<debug_text text="this.assignedcontrolled.idcode + ' this.$kAAIT_data.$target_avoid: ' + @this.$kAAIT_data.$target_avoid.knownname + ' ' + @this.$kAAIT_data.$target_avoid.idcode" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" />
				<include_interrupt_actions ref="kAAIT_CleanOrders" />
				<do_if value="this.assignedcontrolled.order">
					<unassign_order_syncpoint_from_order order="this.assignedcontrolled.order" />
					<do_if value="this.assignedcontrolled.commander.isoperational">
						<signal_objects object="this.assignedcontrolled.commander" param="'kAAIT_tactical_remove_subordinate'" param2="this.assignedcontrolled" />
					</do_if>
				</do_if>
				<create_order object="this.assignedcontrolled" id="'kAAIT_MoveWithdraw'" immediate="true">
					<param name="target" value="this.$kAAIT_data.$target_avoid"/>
				</create_order>
			</actions>

			<handler name="kAAIT_CopyPasteReference" comment="not actually used. only here to save blocks of conditions in.">
				<!--
					NOTE: the chance in debug_text IS a TRUE/FALSE condition. when uncommented, CHANCE of 100 will pass as TRUE. best to comment out after debugging.
				-->
				<conditions>
					<event_object_signalled object="player.galaxy" param="'never signalled'" />
					<check_any comment="get $kAAIT_isAvoidHighRisk. when changed, also change others with the 'get $kAAIT_isAvoidHighRisk' comment.">
						<check_all comment="individual ship setting">
							<check_value value="this.$kAAIT_isAvoidHighRisk_user?" comment="its set" />
							<check_value value="this.$kAAIT_isAvoidHighRisk_user" comment="its set to true" />
							<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
						</check_all>
						<check_all>
							<check_value value="not this.$kAAIT_isAvoidHighRisk_user?" comment="not set" />
							<check_any comment="get from params or selections based on extension options">
								<check_all comment="set by order params">
									<check_any>
										<check_value value="@$kAAITParam_iskAAITOrder" />
										<check_value value="@$kAAITParam_isAvoidHighRisk" />
										<check_value value="@$kAAITParam_isStepForwardWithdraw" />
										<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
									</check_any>
								</check_all>
								<check_all comment="xssm (player-owned)">
									<check_value value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m]" />
									<check_value value="this.isplayerowned" />
									<check_value value="@global.$kAAIT_Config.$xssm_isAvoidHighRisk" />
									<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
								</check_all>
								<check_all comment="xssm (not player-owned)">
									<check_value value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m]" />
									<check_value value="not this.isplayerowned" />
									<check_value value="@global.$kAAIT_Config.$xssm_isAvoidHighRisk_allFactions" />
									<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
								</check_all>
								<check_all comment="lxl (player-owend) v ship">
									<check_value value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]" />
									<check_value value="this.isplayerowned" />
									<check_value value="$kAAIT_attacker.isclass.ship" />
									<check_value value="@global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip" />
									<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
								</check_all>
								<check_all comment="lxl (player-owned) v station">
									<check_value value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]" />
									<check_value value="this.isplayerowned" />
									<check_value value="$kAAIT_attacker.isclass.station" />
									<check_value value="@global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation" />
									<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
								</check_all>
								<check_all comment="lxl (not player-owend) v ship">
									<check_value value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]" />
									<check_value value="not this.isplayerowned" />
									<check_value value="$kAAIT_attacker.isclass.ship" />
									<check_value value="@global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip_allFactions" />
									<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
								</check_all>
								<check_all comment="lxl (not player-owned) v station">
									<check_value value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]" />
									<check_value value="not this.isplayerowned" />
									<check_value value="$kAAIT_attacker.isclass.station" />
									<check_value value="@global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation_allFactions" />
									<set_value name="$kAAIT_isAvoidHighRisk" exact="true" />
								</check_all>
							</check_any>
						</check_all>
					</check_any>
					<check_any comment="get is potential and is high risk. when changed, also change others with the 'get is potential and is high risk' comment.">
						<check_all comment="is already set">
							<check_value value="$kAAIT_attacker == @this.$kAAIT_data.$defensibleTarget" />
							<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="this.$kAAIT_data.$isTargetPotentialHighRisk" />
							<set_value name="$kAAIT_isHighRiskEvent" exact="this.$kAAIT_data.$isTargetHighRisk" />
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER $kAAIT_isPotentialHighRiskEvent is already set to: ' + $kAAIT_isPotentialHighRiskEvent" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER $kAAIT_isHighRiskEvent is already set to: ' + $kAAIT_isHighRiskEvent" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
						</check_all>
						<check_all comment="xss class">
							<check_any>
								<check_value value="not $kAAIT_isPotentialHighRiskEvent?" />
								<check_value value="not $kAAIT_isHighRiskEvent?" />
							</check_any>
							<check_any>
								<check_value value="this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s]" />
								<check_value value="this.assignedcontrolled.primarypurpose != purpose.fight" />
								<check_all>
									<check_value value="this.assignedcontrolled.type == shiptype.carrier" />
									<check_value value="@this.assignedcontrolled.commander.isoperational" />
								</check_all>
							</check_any>
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER xss'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							<check_any>
								<check_all comment="xss v station">
									<check_value value="$kAAIT_attacker.isclass.station" />
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station $kAAIT_isPotentialHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									<set_value name="$kAAIT_gunCount" exact="@$kAAIT_attacker.weapons.operational.count + [@$kAAIT_attacker.weapons.operational.count, @$kAAIT_attacker.turrets.operational.count].max" />
									<set_value name="$kAAIT_gunCount_mult" exact="global.$kAAIT_Config.$xss_outnumberVStations / 100.0" />
									<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers.count * (2 - $kAAIT_skillMult * 1) le $kAAIT_gunCount * $kAAIT_gunCount_mult" />
									<set_value name="$kAAIT_isHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station $kAAIT_isHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								</check_all>
								<check_all comment="xss v ship">
									<check_value value="$kAAIT_attacker.isclass.ship" />
									<check_value value="$kAAIT_attacker.size gt this.assignedcontrolled.size * 1.5" />
									<check_value value="$kAAIT_attacker.primarypurpose == purpose.fight" />
									<check_value value="$kAAIT_attacker.type != shiptype.carrier" />
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship $kAAIT_isPotentialHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									<set_value name="$kAAIT_gunCount" exact="@$kAAIT_attacker.weapons.operational.count" />
									<set_value name="$kAAIT_gunCount_mult" exact="global.$kAAIT_Config.$xss_outnumberVShips / 100.0" />
									<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers.count * (2 - $kAAIT_skillMult * 1) le $kAAIT_gunCount * $kAAIT_gunCount_mult" />
									<set_value name="$kAAIT_isHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship $kAAIT_isHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								</check_all>
							</check_any>
						</check_all>
						<check_all comment="m class">
							<check_any>
								<check_value value="not $kAAIT_isPotentialHighRiskEvent?" />
								<check_value value="not $kAAIT_isHighRiskEvent?" />
							</check_any>
							<check_value value="this.assignedcontrolled.isclass.ship_m" />
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER m'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							<check_any>
								<check_all comment="m v station">
									<check_value value="$kAAIT_attacker.isclass.station" />
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station $kAAIT_isPotentialHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									<set_value name="$kAAIT_gunCount" exact="@$kAAIT_attacker.weapons.operational.count + [@$kAAIT_attacker.weapons.operational.count, @$kAAIT_attacker.turrets.operational.count].max" />
									<set_value name="$kAAIT_gunCount_mult" exact="global.$kAAIT_Config.$m_outnumberVStations / 100.0" />
									<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers.count * (2 - $kAAIT_skillMult * 1) le $kAAIT_gunCount * $kAAIT_gunCount_mult" />
									<set_value name="$kAAIT_isHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station $kAAIT_isHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								</check_all>
								<check_all comment="m v ship">
									<check_value value="$kAAIT_attacker.isclass.ship" />
									<check_value value="$kAAIT_attacker.size gt this.assignedcontrolled.size * 1.5" />
									<check_value value="$kAAIT_attacker.primarypurpose == purpose.fight" />
									<check_value value="$kAAIT_attacker.type != shiptype.carrier" />
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship $kAAIT_isPotentialHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									<set_value name="$kAAIT_gunCount" exact="@$kAAIT_attacker.weapons.operational.count" />
									<set_value name="$kAAIT_gunCount_mult" exact="global.$kAAIT_Config.$m_outnumberVShips / 100.0" />
									<check_value value="@$kAAIT_attackerEntity.$kAAIT_attackers.count * (2 - $kAAIT_skillMult * 1) le $kAAIT_gunCount * $kAAIT_gunCount_mult" />
									<set_value name="$kAAIT_isHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship $kAAIT_isHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								</check_all>
							</check_any>
						</check_all>
						<check_all comment="lxl class">
							<check_any>
								<check_value value="not $kAAIT_isPotentialHighRiskEvent?" />
								<check_value value="not $kAAIT_isHighRiskEvent?" />
							</check_any>
							<check_value value="this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl]" />
							<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER lxl'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							<check_any>
								<check_all>
									<check_value value="$kAAIT_attacker.isclass.station" />
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station $kAAIT_isPotentialHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									<set_value name="$kAAIT_isHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station $kAAIT_isHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								</check_all>
								<check_all>
									<check_value value="$kAAIT_attacker.size gt this.assignedcontrolled.size * 1.5" />
									<check_value value="$kAAIT_attacker.primarypurpose == purpose.fight" />
									<check_value value="$kAAIT_attacker.type != shiptype.carrier" />
									<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship $kAAIT_isPotentialHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
									<check_value value="$kAAIT_attacker.dps.all gt this.assignedcontrolled.dps.all * 1.25" />
									<set_value name="$kAAIT_isHighRiskEvent" exact="true" />
									<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship $kAAIT_isHighRiskEvent'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
								</check_all>
							</check_any>
						</check_all>
					</check_any>
					<check_all comment="get is avoid or withdraw now. when changed, also change others with the 'get is avoid or withdraw now' comment.">
						<set_value name="$kAAIT_skillMult" exact="(@this.skill.piloting + @this.skill.morale) / 30.0" />
						<check_all comment="get is potential high risk">
							<check_any>
								<check_value value="this.assignedcontrolled.primarypurpose != purpose.fight" />
								<check_all>
									<check_value value="this.assignedcontrolled.type == shiptype.carrier" />
									<check_value value="@this.assignedcontrolled.commander.isoperational" />
								</check_all>
								<check_value value="$kAAIT_attacker.isclass.station" />
								<check_value value="$kAAIT_attacker.size gt this.assignedcontrolled.size * 1.5" />
							</check_any>
							<set_value name="$kAAIT_isPotentialHighRiskEvent" exact="true" />
						</check_all>
						<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER $kAAIT_isPotentialHighRiskEvent: ' + @$kAAIT_isPotentialHighRiskEvent + '. need $kAAIT_isHighRiskEvent after.'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
						<check_value value="$kAAIT_isPotentialHighRiskEvent" />
						<check_any comment="get $kAAIT_isActOnEventNow.">
							<check_all comment="no operational weapons">
								<check_value value="not @this.assignedcontrolled.weapons.all.count" />
								<set_value name="$kAAIT_isActOnEventNow" exact="true" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER no operational weapons'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							</check_all>
							<check_all comment="too few operational weapons">
								<check_value value="@this.assignedcontrolled.weapons.operational.count / (this.assignedcontrolled.weapons.all.count)f le 0.25" />
								<set_value name="$kAAIT_isActOnEventNow" exact="true" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER too few operational weapons'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							</check_all>
							<check_all comment="v station">
								<check_value value="$kAAIT_attacker.isclass.station" />
								<check_value value="this.assignedcontrolled.shieldpercentage le 75 + $kAAIT_skillMult * 15" />
								<set_value name="$kAAIT_isActOnEventNow" exact="true" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v station shieldpercentage: ' + (this.assignedcontrolled.shieldpercentage) + ' le? ' + (75 + $kAAIT_skillMult * 15)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							</check_all>
							<check_all comment="v ship">
								<check_value value="$kAAIT_attacker.isclass.ship" />
								<check_value value="this.assignedcontrolled.shieldpercentage le 75 + $kAAIT_skillMult * 15" />
								<set_value name="$kAAIT_isActOnEventNow" exact="true" />
								<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER v ship shieldpercentage: ' + (this.assignedcontrolled.shieldpercentage) + ' le? ' + (75 + $kAAIT_skillMult * 15)" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
							</check_all>
						</check_any>
						<!-- <debug_text text="this.assignedcontrolled.idcode + ' UNKNOWN HANDLER $kAAIT_isActOnEventNow: ' + @$kAAIT_isActOnEventNow" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0" /> -->
					</check_all>
				</conditions>
				<actions>
				</actions>
			</handler>
		</library>
	</interrupts>
</aiscript>
