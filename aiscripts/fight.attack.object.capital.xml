<?xml version='1.0' encoding='utf-8'?>
<diff>
  <replace sel="/aiscript/interrupts/library/actions[@name='CapitalLaunchFighters']/do_if[@value='$iscarrier']/@value">$iscarrier or this.assignedcontrolled.subordinates.count</replace>
  <replace sel="/aiscript/interrupts/library/actions[@name='CapitalLaunchFighters']/do_if[@value='$iscarrier or this.assignedcontrolled.subordinates.count']/do_elseif[@value='@this.ship.pilot.$escortgroup.count']/do_else/do_if[@value='@this.ship.pilot.$escortgroup.count']/do_all[@exact='$loctargetlist.count']/do_if[@value='$availableships.count']/do_if[@value='$loctarget.canbeattacked and (not @$engagedcarriertargets.indexof.{$loctarget} or ($loctarget == @$primarytarget) or (@$primarytarget.canbeattacked and @$loctarget.hascontext.{$primarytarget}))']/do_if[@value='@$primarytarget.canbeattacked and (($loctarget == $primarytarget) or ($loctarget.hascontext.{$primarytarget}))']/set_value[@name='$numsend'][@exact='$numsend * [this.assignedcontrolled.combinedskill / 20, 1].max']/@exact">$numsend * 5</replace>
  <remove sel="/aiscript/init/set_value[@name='$scantime'][@exact='500ms + ((1.0 - (@this.assignedcontrolled.combinedskill / 100.0)) * 60s)']/@exact"/>
  <add sel="/aiscript/init/set_value[@name='$scantime']" type="@min">500ms</add>
  <add sel="/aiscript/init/set_value[@name='$scantime'][@min='500ms']" type="@max">1s</add>
  <remove sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$scantime'][@exact='500ms + ((1.0 - (@this.assignedcontrolled.combinedskill / 100.0)) * 60s)']/@exact"/>
  <add sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$scantime']" type="@min">500ms</add>
  <add sel="/aiscript/attention[@min='visible']/actions/set_value[@name='$scantime'][@min='500ms']" type="@max">1s</add>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='this.ship.pilot and (@$targets.count or $dronetargets.count or ($miningtargets.count and this.ship == player.occupiedship))']/do_if[@value='@$primarytarget.canbeattacked']/do_elseif[@value='(this.assignedcontrolled != player.occupiedship) and not this.assignedcontrolled.dock']/shoot_at[@largetarget='$largetarget'][@tolerance='10.0deg']/@tolerance">4.0deg</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='this.ship.pilot and (@$targets.count or $dronetargets.count or ($miningtargets.count and this.ship == player.occupiedship))']/do_if[@value='@$primarytarget.canbeattacked']/do_elseif[@value='(this.assignedcontrolled != player.occupiedship) and not this.assignedcontrolled.dock']/shoot_at[@largetarget='$largetarget'][@tolerance='360.0deg']/@tolerance">if $largetarget then 8.0deg else 4.0deg</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='this.ship.pilot and (@$targets.count or $dronetargets.count or ($miningtargets.count and this.ship == player.occupiedship))']/do_if[@value='$dronetargets.count and not this.$launchedunitcount? and this.assignedcontrolled.units.{unitcategory.defence}.count and not this.assignedcontrolled.zone.isclass.highway and not this.assignedcontrolled.travel.active']/do_if[@value='not $donotlaunchdefencedrones? and this.assignedcontrolled.hasarmeddefencedrones']/do_if[@value='player.age'][@min='$lastdronelaunch + 500ms + ((1.0 - (this.assignedcontrolled.combinedskill / 100.0)) * 60s)']/@min">$lastdronelaunch + 1s</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='this.ship.pilot and (@$targets.count or $dronetargets.count or ($miningtargets.count and this.ship == player.occupiedship))']/do_if[@value='$dronetargets.count and not this.$launchedunitcount? and this.assignedcontrolled.units.{unitcategory.defence}.count and not this.assignedcontrolled.zone.isclass.highway and not this.assignedcontrolled.travel.active']/do_if[@value='not $donotlaunchdefencedrones? and this.assignedcontrolled.hasarmeddefencedrones']/do_if[@value='player.age'][@min='$lastdronelaunch + 1s']/do_if[@value='not $num_launchtubes and $num_dronedocks']/do_else/set_value[@name='$maxnum_dronespersquad'][@exact='[[$num_dronedocks * [1.2 - (@this.ship.pilot.skill.piloting / 15.0), 1.0].min, 1].max, this.ship.availableunits.{unitcategory.defence}.count].min']/@exact">[[$num_dronedocks * 0.2, 1].max, this.assignedcontrolled.availableunits.{unitcategory.defence}.count].min</replace>
  <replace sel="/aiscript/attention[@min='visible']/actions/do_if[@value='this.ship.pilot and (@$targets.count or $dronetargets.count or ($miningtargets.count and this.ship == player.occupiedship))']/do_if[@value='$dronetargets.count and not this.$launchedunitcount? and this.assignedcontrolled.units.{unitcategory.defence}.count and not this.assignedcontrolled.zone.isclass.highway and not this.assignedcontrolled.travel.active']/do_if[@value='not $donotlaunchdefencedrones? and this.assignedcontrolled.hasarmeddefencedrones']/do_if[@value='player.age'][@min='$lastdronelaunch + 1s']/do_else[1]/do_else/set_value[@name='$maxnum_dronespersquad'][@exact='[[$num_launchtubes * [1.2 - (@this.ship.pilot.skill.piloting / 15.0), 1.0].min, 1].max, this.ship.availableunits.{unitcategory.defence}.count].min']/@exact">[[$num_launchtubes * 0.2, 1].max, this.assignedcontrolled.availableunits.{unitcategory.defence}.count].min</replace>
  <replace sel="/aiscript/attention[@min='unknown']/actions/do_while[@value='player.age lt $attacktime and this.ship.pilot and @$targets_defensibles.count and this.sector']/do_all[@exact='$targets_defensibles_list.count']/do_if[@value='not @$maxtargets']/set_value[@name='$maxtargets'][@exact='[this.ship.turrets.operational.count, $targets_defensibles_list.count, [$combinedskill / 10, 2].max].min']/@exact">[this.assignedcontrolled.turrets.operational.count, $targets_defensibles_list.count,10].min</replace>
  <replace sel="/aiscript/attention[@min='unknown']/actions/do_while[@value='player.age lt $attacktime and this.ship.pilot and @$targets_defensibles.count and this.sector']/do_all[@exact='$targets_defensibles_list.count']/do_if[@value='not @$maxtargets']/set_value[@name='$maxtargets'][@min='1'][@max='$maxtargets']/@max">[$maxtargets,1].max</replace>
  <replace sel="/aiscript/attention[@min='unknown']/actions/do_while[@value='player.age lt $attacktime and this.ship.pilot and @$targets_defensibles.count and this.sector']/do_all[@exact='$targets_defensibles_list.count']/do_if[@value='this.assignedcontrolled.pilot and @$target.canbeattacked and not @$target.dock and not $target.zone.isclass.highway and this.assignedcontrolled.mayattack.{$target} and (this.assignedcontrolled.bboxdistanceto.{$target} le $FiringRange)']/do_if[@value='true']/@chance">[100, 90].random</replace>
</diff>
