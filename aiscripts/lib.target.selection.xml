<?xml version='1.0' encoding='utf-8'?>
<diff>
  <replace sel="/aiscript/attention[@min='unknown']/actions/do_all[@exact='$targets.count']/do_elseif[@value='$distance lt 5500m']">
    <do_else>
      <set_value name="$priority" exact="[$priority + (10.0 - ($distance - [this.assignedcontrolled.maxcombatrange.all,1m].max)f / [this.assignedcontrolled.maxcombatrange.all,1m].max),0.01].max"/>
      <debug_text text="'evaluated distance. priority: %s, distance: %sm'.[$priority, $distance]" chance="$debugchance"/>
    </do_else>
  </replace>
  <add sel="/aiscript/attention[@min='unknown']/actions/do_all[@exact='$targets.count']/do_if[@value='$priority gt $highest']" pos="before">
    <do_if value="this.assignedcontrolled.isclass.ship">
      <do_if value="this.assignedcontrolled.isclass.ship_xl">
        <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_l, class.ship_xl, class.station] then 2 else (if $targets.{$i}.isclass.[class.ship_xs, class.ship_s] then 0.5 else 1))"/>
      </do_if>
      <do_elseif value="this.assignedcontrolled.isclass.ship_l">
        <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_m, class.ship_l, class.ship_xl] then 2 else (if $targets.{$i}.isclass.[class.ship_xs, class.ship_s] then 0.5 else 1))"/>
      </do_elseif>
      <do_elseif value="this.assignedcontrolled.isclass.ship_m">
        <do_if value="(this.assignedcontrolled.ammostorage.missile.count) and (this.assignedcontrolled.dps.missiles.all gt 0)">
          <do_for_each name="$missilelauncher" in="this.assignedcontrolled.weapons.operational.list">
            <do_if value="(macro.weapon_gen_m_torpedo_01_mk1_macro == $missilelauncher.macro) or (macro.weapon_gen_m_torpedo_01_mk2_macro == $missilelauncher.macro)">
              <set_value name="$hastorpedo" exact="$true"/>
              <break/>
            </do_if>
            <do_if value="$hastorpedo">
              <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_l, class.ship_xl, class.station] then 2 else (if $targets.{$i}.isclass.[class.ship_xs, class.ship_s] then 0.5 else 1))"/>
              <remove_value name="$hastorpedo"/>
            </do_if>
            <do_else>
              <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_s, class.ship_m, class.ship_l] then 2 else (if $targets.{$i}.isclass.[class.ship_xs, class.ship_xl, class.station] then 0.5 else 1))"/>
            </do_else>
          </do_for_each>
        </do_if>
        <do_else>
          <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_s, class.ship_m, class.ship_l] then 2 else (if $targets.{$i}.isclass.[class.ship_xs, class.ship_xl, class.station] then 0.5 else 1))"/>
        </do_else>
      </do_elseif>
      <do_elseif value="this.assignedcontrolled.isclass.ship_s">
        <do_if value="(this.assignedcontrolled.ammostorage.missile.count) and (this.assignedcontrolled.dps.missiles.all gt 0)">
          <do_for_each name="$missilelauncher" in="this.assignedcontrolled.weapons.operational.list">
            <do_if value="(macro.weapon_gen_s_torpedo_01_mk1_macro == $missilelauncher.macro) or (macro.weapon_gen_s_torpedo_01_mk2_macro == $missilelauncher.macro)">
              <set_value name="$hastorpedo" exact="$true"/>
              <break/>
            </do_if>
            <do_if value="$hastorpedo">
              <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_l, class.ship_xl, class.station] then 2 else (if $targets.{$i}.isclass.[class.ship_xs, class.ship_s] then 0.5 else 1))"/>
            </do_if>
            <do_else>
              <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_xs, class.ship_s, class.ship_m] then 2 else (if $targets.{$i}.isclass.[class.ship_l, class.ship_xl, class.station] then 0.5 else 1))"/>
            </do_else>
          </do_for_each>
        </do_if>
        <do_else>
          <set_value name="$priority" exact="$priority * (if $targets.{$i}.isclass.[class.ship_xs, class.ship_s, class.ship_m] then 2 else (if $targets.{$i}.isclass.[class.ship_l, class.ship_xl, class.station] then 0.5 else 1))"/>
        </do_else>
      </do_elseif>
    </do_if>
  </add>
</diff>
