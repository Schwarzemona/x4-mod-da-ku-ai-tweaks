<?xml version='1.0' encoding='utf-8'?>
<diff>
<!-- add. purpose: params.
	<params>
-->
	<add sel="//params">
		<param name="kAAITParam_isAvoidHighRisk" required="false" type="bool" text="{1111920, 3}" default="
			if (not this.assignedcontrolled.isunit) and (not this.assignedcontrolled.islasertower) and
			(
				(
					this.assignedcontrolled.isplayerowned and
					(this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or this.assignedcontrolled.primarypurpose != purpose.fight) and
					@global.$kAAIT_Config.$xssm_isAvoidHighRisk and
					(
						(not global.$kAAIT_Config.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user?) or
						@global.$kAAIT_Config.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user
					)
				) or
				(
					(not this.assignedcontrolled.isplayerowned) and
					(this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or this.assignedcontrolled.primarypurpose != purpose.fight) and
					@global.$kAAIT_Config.$xssm_isAvoidHighRisk_allFactions
				) or
				(
					this.assignedcontrolled.isplayerowned and
					this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
					(@global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip or @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation) and
					(
						(not global.$kAAIT_Config.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user?) or
						@global.$kAAIT_Config.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user
					)
				) or
				(
					(not this.assignedcontrolled.isplayerowned) and
					this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
					(@global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip_allFactions or @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation_allFactions)
				)
			) then true else false
		" />
	</add>
<!-- add. purpose: withdraw ai.
	<interrupts>
-->
	<add pos="prepend" sel="//interrupts">
		<handler ref="kAAIT_Handler_AvoidWithdrawOrJustFight"/>
	</add>
<!-- add. purpose: debug.
	<run_script name="'order.fight.escort'">
	<run_script name="'order.move.follow'">
	<run_script name="'order.move.wait.object'">
	<run_script name="'order.move.wait'">
-->
	<add pos="before" sel="//run_script[@name=&quot;'order.fight.escort'&quot;]">
		<debug_text text="this.assignedcontrolled.idcode + ' run_script order.fight.escort'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
	</add>
	<add pos="before" sel="//run_script[@name=&quot;'order.move.follow'&quot;]">
		<debug_text text="this.assignedcontrolled.idcode + ' run_script order.move.follow'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
	</add>
	<add pos="before" sel="//run_script[@name=&quot;'order.move.wait.object'&quot;]">
		<debug_text text="this.assignedcontrolled.idcode + ' run_script order.move.wait.object'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
	</add>
	<add pos="before" sel="//run_script[@name=&quot;'order.move.wait'&quot;]">
		<debug_text text="this.assignedcontrolled.idcode + ' run_script order.move.wait'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
	</add>
<!-- add after. purpose: finish.
	<label name="finish" />
-->
	<add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;finish&quot;]">
		<include_interrupt_actions ref="kAAIT_Deinit" />
	</add>
<!-- add. purpose: clean-up.
	<on_abort>
-->
	<add sel="//on_abort">
		<include_interrupt_actions ref="kAAIT_Deinit" />
	</add>
	<!-- DeadAir Diffs -->
	<replace sel="/aiscript/attention[@min='unknown']/actions/do_if[@value='not this.isplayerowned']/@chance">[90, 70].random</replace>
	<remove sel="/aiscript/attention[@min='unknown']/actions/wait[@exact='[((100 - this.assignedcontrolled.combinedskill) / 20)s, 1ms].max']/@exact"/>
	<add sel="/aiscript/attention[@min='unknown']/actions/wait" type="@min">500ms</add>
	<add sel="/aiscript/attention[@min='unknown']/actions/wait[@min='500ms']" type="@max">1s</add>
</diff>
