<?xml version='1.0' encoding='utf-8'?>
<diff>
<!-- add. purpose: params.
  <params>
-->
  <add sel="//params">
    <param name="kAAITParam_isAvoidHighRisk" required="false" type="bool" text="{1111920, 3}" default="
      if this.$kAAIT_isAvoidHighRisk_user? then 
        this.$kAAIT_isAvoidHighRisk_user
      else (
        if (not this.assignedcontrolled.isunit) and (not this.assignedcontrolled.islasertower) and
        (
          (
            this.assignedcontrolled.isplayerowned and
            (
              this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or
              this.assignedcontrolled.primarypurpose != purpose.fight or
              (
                this.assignedcontrolled.type == shiptype.carrier and
                @this.assignedcontrolled.commander.isoperational
              )
            ) and
            @global.$kAAIT_Config.$xssm_isAvoidHighRisk
          ) or
          (
            (not this.assignedcontrolled.isplayerowned) and
            (
              this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or
              this.assignedcontrolled.primarypurpose != purpose.fight or
              (
                this.assignedcontrolled.type == shiptype.carrier and
                @this.assignedcontrolled.commander.isoperational
              )
            ) and
            @global.$kAAIT_Config.$xssm_isAvoidHighRisk_allFactions
          ) or
          (
            this.assignedcontrolled.isplayerowned and
            this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
            (
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip or
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation
            )
          ) or
          (
            (not this.assignedcontrolled.isplayerowned) and
            this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
            (
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vShip_allFactions or
              @global.$kAAIT_Config.$lxl_isAvoidHighRisk_vStation_allFactions
            )
          )
        ) then true else false
      )
    "/>
  </add>
<!-- add. purpose: withdraw ai.
  <interrupts>
-->
  <add pos="prepend" sel="//interrupts">
    <handler ref="kAAIT_Handler_AvoidWithdrawOrJustFight"/>
  </add>
<!-- add. purpose: debug.
  <run_script name="'order.fight.escort'">
  <run_script name="'order.move.follow'">
  <run_script name="'order.move.wait.object'">
  <run_script name="'order.move.wait'">
-->
  <add pos="before" sel="//run_script[@name=&quot;'order.fight.escort'&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' run_script order.fight.escort'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//run_script[@name=&quot;'order.move.follow'&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' run_script order.move.follow'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//run_script[@name=&quot;'order.move.wait.object'&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' run_script order.move.wait.object'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
  <add pos="before" sel="//run_script[@name=&quot;'order.move.wait'&quot;]">
    <debug_text text="this.assignedcontrolled.idcode + ' run_script order.move.wait'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Config.$debugChance else 0"/>
  </add>
<!-- add after. purpose: finish.
  <label name="finish" />
-->
  <add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;finish&quot;]">
    <include_interrupt_actions ref="kAAIT_Deinit" />
  </add>
<!-- add. purpose: clean-up.
  <on_abort>
-->
  <add sel="//on_abort">
    <include_interrupt_actions ref="kAAIT_Deinit" />
  </add>
</diff>
