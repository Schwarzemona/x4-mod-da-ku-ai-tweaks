<?xml version='1.0' encoding='utf-8'?>
<diff>
<!-- add. purspose: do not restock if commander has an attack order or there's an enemy nearby.
  <signal_objects object="this.ship" param="'resupply'" param2="[false]" param3="$debugchance" comment="param2 = [urgent?, resupplystationID], param3 = $debugchance"/>
-->
  <add pos="before" sel="//signal_objects[@param=&quot;'resupply'&quot;]">
    <set_value name="$kAAIT_restockChance" exact="100" />
    <include_interrupt_actions ref="kAAIT_GetBigEnemies" />
    <include_interrupt_actions ref="kAAIT_GetIsNearBigEnemies" />
    <do_if value="
      @$kAAIT_bigEnemy.isoperational or
      @this.assignedcontrolled.commaner.order.id == 'Attack' or
      @this.assignedcontrolled.commaner.nextoder.id == 'Attack' or
      @this.assignedcontrolled.commaner.order.id == 'TacticalOrder' or
      @this.assignedcontrolled.commaner.nextoder.id == 'TacticalOrder'">
      <set_value name="$kAAIT_restockChance" exact="0" />
    </do_if>
  </add>
  <add sel="//signal_objects[@param=&quot;'resupply'&quot;]" type="@chance">$kAAIT_restockChance</add>
</diff>
