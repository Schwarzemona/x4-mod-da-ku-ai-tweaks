<?xml version='1.0' encoding='utf-8'?>
<diff>
<!-- add. purpose: params.
	<params>
-->
	<add sel="//params">
		<param name="kAAITParam_isAvoidHighRisk" required="false" type="bool" text="{1111920, 3}" default="
			if (not this.assignedcontrolled.isunit) and (not this.assignedcontrolled.islasertower) and
			(
				(
					this.assignedcontrolled.isplayerowned and
					(this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or this.assignedcontrolled.primarypurpose != purpose.fight) and
					@global.$kAAIT_Data.$xssm_isAvoidHighRisk and
					(
						(not global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user?) or
						@global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user
					)
				) or
				(
					(not this.assignedcontrolled.isplayerowned) and
					(this.assignedcontrolled.isclass.[class.ship_xs, class.ship_s, class.ship_m] or this.assignedcontrolled.primarypurpose != purpose.fight) and
					@global.$kAAIT_Data.$xssm_isAvoidHighRisk_allFactions
				) or
				(
					this.assignedcontrolled.isplayerowned and
					this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
					(@global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip or @global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation) and
					(
						(not global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user?) or
						@global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_isAvoidHighRisk_user
					)
				) or
				(
					(not this.assignedcontrolled.isplayerowned) and
					this.assignedcontrolled.isclass.[class.ship_l, class.ship_xl] and
					(@global.$kAAIT_Data.$lxl_isAvoidHighRisk_vShip_allFactions or @global.$kAAIT_Data.$lxl_isAvoidHighRisk_vStation_allFactions)
				)
			) then true else false
		" />
	</add>
<!-- add before. purpose: show movement.
	<location object="$target" />
-->
	<add pos="before" sel="//location[@object=&quot;$target&quot;]">
		<location object="@global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_data.$orderLocation_space" position="@global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_data.$orderLocation_pos" condition="@global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_data.$orderLocation_space and @global.$kAAIT_Data.$settingsByShipId.{'$' + @this.assignedcontrolled.idcode}.$kAAIT_data.$orderLocation_pos" />
	</add>
<!-- add. purpose: withdraw ai.
	<interrupts>
-->
	<add pos="prepend" sel="//interrupts">
		<handler ref="kAAIT_Handler_AvoidWithdrawOrJustFight" />
	</add>
<!-- add. purpose: debug.
	<init>
-->
	<add sel="//init">
		<debug_text text="this.assignedcontrolled.idcode + ' LABEL init'" chance="if @this.assignedcontrolled.idcode == @global.$kAAIT.$debugChance_idCode then @global.$kAAIT_Data.$debugChance else 0" />
	</add>
<!-- add after. purpose: finish.
	<label name="finish" />
-->
	<add pos="after" sel="//attention[@min=&quot;unknown&quot;]//label[@name=&quot;finish&quot;]">
		<include_interrupt_actions ref="kAAIT_Deinit" />
	</add>
<!-- add. purpose: clean-up.
	<on_abort>
-->
	<add sel="//attention">
		<on_abort>
			<include_interrupt_actions ref="kAAIT_Deinit" />
		</on_abort>
	</add>
</diff>
